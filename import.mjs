// jsonstat-suite v3.0.3 Copyright 2019 Xavier Badosa https://jsonstat.com
var e="1.0.8";function t(e){var n,r,i,l,a=function(e,t){var n,r=[];if("string"==typeof e&&(e=[e]),Array.isArray(e)){if(e.length===t)return e;if(1===e.length){for(n=0;n<t;n++)r.push(e[0]);return r}}for(n=0;n<t;n++){var i=void 0===e[n]?null:e[n];r.push(i)}return r};if(this.length=0,this.id=[],null!=e)switch(this.class=e.class||"bundle",this.class){case"bundle":var s=[],o=0;if(this.error=null,this.length=0,null===e||"object"!=typeof e)return void(this.class=null);if(e.hasOwnProperty("error"))return void(this.error=e.error);if("dataset"===e.class||"collection"===e.class||"dimension"===e.class)return new t(e);for(r in e)o++,s.push(r);this.__tree__=e,this.length=o,this.id=s;break;case"dataset":e.hasOwnProperty("__tree__")?this.__tree__=n=e.__tree__:this.__tree__=n=e,this.label=n.label||null,this.note=n.note||null,this.link=n.link||null,this.href=n.href||null,this.updated=n.updated||null,this.source=n.source||null,this.extension=n.extension||null;var u,c=0,f=n.size||n.dimension&&n.dimension.size;if(this.size=f,n.hasOwnProperty("value")&&Array.isArray(n.value))c=n.value.length;else{var h=1;for(u=f.length;u--;)h*=f[u];c=h}if(this.value=a(n.value,c),this.status=n.hasOwnProperty("status")?a(n.status,c):null,n.hasOwnProperty("dimension")){var d=n.dimension,v=n.role||!n.version&&d.role||null,p=n.id||d.id,g=f.length,y=function(e){v.hasOwnProperty(e)||(v[e]=null)};if(!Array.isArray(p)||!Array.isArray(f)||p.length!=g)return;if(this.length=g,this.id=p,v&&(y("time"),y("geo"),y("metric"),y("classification")),v&&null===v.classification){var b=[],m=["time","geo","metric"],_=function(e,t){for(var n=t.length;n--;)if(e===t[n])return!0;return!1};for(u=0;u<3;u++){var w=v[m[u]];null!==w&&(b=b.concat(w))}for(v.classification=[],u=0;u<g;u++)_(p[u],b)||v.classification.push(p[u]);0===v.classification.length&&(v.classification=null)}this.role=v,this.n=c;for(var x=0,O=this.length;x<O;x++)if(d[p[x]].category.hasOwnProperty("index")){if(Array.isArray(d[p[x]].category.index)){var E={},A=d[p[x]].category.index;for(i=A.length,l=0;l<i;l++)E[A[l]]=l;d[p[x]].category.index=E}}else{var D=0;for(r in d[p[x]].category.index={},d[p[x]].category.label)d[p[x]].category.index[r]=D++}}else this.length=0;break;case"dimension":if(!e.hasOwnProperty("__tree__"))return new t({version:"2.0",class:"dataset",dimension:{d:e},id:["d"],size:[function(e){var t=void 0===e.index?e.label:e.index;return Array.isArray(t)?t.length:Object.keys(t).length}(e.category)],value:[null]}).Dimension(0);var S=[],P=(n=e.__tree__).category;if(!n.hasOwnProperty("category"))return;if(!P.hasOwnProperty("label"))for(r in P.label={},P.index)P.label[r]=r;for(r in P.index)S[P.index[r]]=r;this.__tree__=n,this.label=n.label||null,this.note=n.note||null,this.link=n.link||null,this.href=n.href||null,this.id=S,this.length=S.length,this.role=e.role,this.hierarchy=P.hasOwnProperty("child"),this.extension=n.extension||null;break;case"category":var k=e.child;this.id=k,this.length=null===k?0:k.length,this.index=e.index,this.label=e.label,this.note=e.note||null,this.unit=e.unit,this.coordinates=e.coord;break;case"collection":if(this.length=0,this.label=e.label||null,this.note=e.note||null,this.link=e.link||null,this.href=e.href||null,this.updated=e.updated||null,this.source=e.source||null,this.extension=e.extension||null,null!==this.link&&e.link.item){var j=e.link.item;if(this.length=Array.isArray(j)?j.length:0,this.length)for(l=0;l<this.length;l++)this.id[l]=j[l].href}}}function n(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.json()}function r(r,i){return"object"==typeof r?new t(r):"version"===r?e:fetch?fetch(r,i).then(n).then((function(e){return new t(e)})):void 0}function i(e,t){return null==e?null:("string"!=typeof e&&void 0!==e.length||(e=r(e)),0===e.length||"dataset"!==e.class&&"collection"!==e.class&&"bundle"!==e.class?null:"dataset"===e.class?e:e.Dataset(t))}function l(e){if(null===e||0===e.length||"dataset"!==e.class)return!1;for(var t=e.length,n=1;t--;)n*=e.Dimension(t).length;return n===e.n}function a(e,t,n){var r,i,l,a,s;return(t.label||n).capitalize()+(i=t,s="",(r=e)&&"metric"===r.role&&i.unit&&(l=i.unit.hasOwnProperty("label")?i.unit.label:"")+(a=i.unit.hasOwnProperty("symbol")?i.unit.symbol:"")!==""&&(s=" ("+(s=""===a?l:""===l?a:"start"===i.unit.position?a+l:l+" "+a)+")"),s)}function s(e,t,n){var r,i='<select name="'+t+'">',l=[];if(null!==n[1]){if(r=e.id,l=e.Dimension(),2===r.length)return(e.Dimension(n[0]).label||n[0]).capitalize()}else{var s=e.Dimension(t);if(r=s.id,l=s.Category(),1===r.length)return}return r.forEach((function(e,t){var r=e!==n[0]?"":'selected="selected" ';null!==n[1]&&e===n[1]||(i+="<option "+r+'value="'+e+'">'+a(s,l[t],e)+"</option>")})),i+="</select>"}function o(e,t,n){function r(e){void 0!==t?t.innerHTML=o[e]:window.alert(o[e])}if(void 0!==e)if(void 0!==t){void 0===n&&(n={});var o=void 0===n.i18n||void 0===n.i18n.msgs?{urierror:"tbrowser: A valid JSON-stat input must be specified.",selerror:"tbrowser: A valid selector must be specified.",jsonerror:"The request did not return a valid JSON-stat dataset.",dimerror:"Only one dimension was found in the dataset. At least two are required.",dataerror:"Selection returned no data!",source:"Source",filters:"Filters",constants:"Constants",rc:"Rows &amp; Columns",na:"n/a"}:n.i18n.msgs,u=void 0===n.i18n||void 0===n.i18n.locale?"en-US":n.i18n.locale,c=n.dsid||0,f=n.status||!1,h=n.tblclass||"",d=n.nonconst||!1,v=i(e,c);if(l(v)){if(d)var p=function(e){var t=0,n=e.size.slice(0),r=[];return n.forEach((function(n,i){var l=i-t,a=e.Dimension(l);1===n&&(delete e.__tree__.dimension[e.id[l]],e.size.splice(l,1),e.id.splice(l,1),e.length--,t++,r.push(a.label.capitalize()+": "+a.Category(0).label.capitalize()))})),r}(v);1!==v.length?function e(t,n,r,i){var l="",c="",h="",v="",g=r.rows,y=n.Dimension(g),b=y.id,m=r.cols,_=n.Dimension(m),w=_.id,x=n.role&&n.role.metric?n.role.metric[0]:null,O=null!==x?n.Dimension(x):null,E=function(e){return e.hasOwnProperty("unit")&&e.unit&&e.unit.hasOwnProperty("decimals")?e.unit.decimals:null},A=r.filter,D=JSON.parse(JSON.stringify(A)),S=[],P="",k="",j=n.source?o.source+": "+n.source:"",z=null!==n.label?'<span class="label">'+n.label.capitalize()+"</span>":"";for(var C in d&&p.length&&(z='<span class="label">'+p.join(". ")+"</span>"),""!==j&&"."!==j.slice(-1)&&(j+="."),h+="<caption>"+z+"<form>",A){var T=n.Dimension(C),N=T.label?T.label.capitalize():C.capitalize();T.length>1?P+="<p>"+s(n,C,[A[C],null])+" <strong>"+N+"</strong></p>":S.push({label:N,value:a(T,T.Category(0)),name:C,id:T.id[0]})}""!==P&&(P='<fieldset id="filters"><legend>'+o.filters+"</legend>"+P+"</fieldset>"),S.forEach((function(e){k+="<p>"+e.value+" <strong>"+e.label+'</strong></p><input type="hidden" name="'+e.name+'" value="'+e.id+'" />'})),""!==k&&(k='<fieldset id="constants"><legend>'+o.constants+"</legend>"+k+"</fieldset>"),h+=k+P+'<fieldset id="rowscols"><legend>'+o.rc+"</legend>"+s(n,"rows",[g,m])+" <a>&#x2194;</a> "+s(n,"cols",[m,g])+"</fieldset></form></caption>",v+="<tbody>";var R=Number.toLocaleString?function(e,t){return null===t?e.toLocaleString(u):e.toLocaleString(u,{minimumFractionDigits:t,maximumFractionDigits:t})}:function(e,t){return null===t?e:e.toFixed(t)};if(b.forEach((function(e){D[g]=e;var t=n.Data(D),r=function(e,t){var n,r=m!==x?null===O?null:E(O.Category(D[x])):E(_.Category(t));null!==e.value?(n=R(e.value,r),f&&null!==e.status&&(n+=" ("+e.status+")")):n=e.status||o.na,v+="<td>"+n+"</td>"};null!==t?(v+='<tr><th scope="row">'+a(y,y.Category(e))+"</th>",Array.isArray(t)?t.forEach((function(e,t){r(e,t)})):r(t,0),v+="</tr>"):v="ERROR"})),"ERROR"===v)return o.dataerror;v+="</tbody>",l+="<thead><tr><th></th>",w.forEach((function(e){l+='<th scope="col">'+a(_,_.Category(e))+"</th>"})),l+="</tr></thead>",""!==j&&(c='<tfoot><tr><td colspan="'+(w.length+1)+'">'+j+"</td></tr></tfoot>"),t.innerHTML='<table class="'+i+'">'+h+l+c+v+"</table>",[].slice.call(t.querySelectorAll("select")).forEach((function(r){r.addEventListener("change",(function(r){var l,a;e(t,n,function(e,t,n){var r={filter:{}};return n.forEach((function(e){"rows"===e.name||"cols"===e.name?r[e.name]=e.value:r.filter[e.name]=e.value})),"rowscols"===t&&e.id.forEach((function(t,n){t!==r.rows&&t!==r.cols?void 0===r.filter[t]&&(r.filter[t]=e.Dimension(n).id[0]):delete r.filter[t]})),r}(n,r.target.parentElement.getAttribute("id"),(l=t,a=[],[].slice.call(l.querySelectorAll("select, input")).forEach((function(e){a.push({name:e.name,value:e.value})})),a)),i)}),!1)})),t.querySelector("a").addEventListener("click",(function(){r.cols=g,r.rows=m,e(t,n,r,i)}),!1)}(t,v,function(e,t){var n,r,i={},l=[],a=e.id;if(t){var s="bigger"===t?function(e,t){return e.len<t.len?1:-1}:function(e,t){return e.len>t.len?1:-1};e.Dimension().forEach((function(e,t){l.push({id:a[t],len:e.length})})),l.sort(s),n=l[0].id,r=l[1].id}else n=a[0],r=a[1];return e.Dimension(n).length<e.Dimension(r).length&&(n=r+(r=n,"")),a.forEach((function(t){t!==n&&t!==r&&(i[t]=e.Dimension(t).id[0])})),{rows:n,cols:r,filter:i}}(v,n.preset),h):r("dimerror")}else r("jsonerror")}else r("selerror");else r("urierror")}function u(e,t){if(void 0===e)return null;void 0===t&&(t={});var n="",r="",a=0,s=t.na||"n/a",o=t.dsid||0,u=t.vlabel||null,c=t.slabel||null,f=t.counter||!1,h=t.tblclass||"",d=t.numclass||"",v=t.valclass||"",p=t.status||!1,g=t.locale||"en-US",y=t.source||"Source",b=i(e,o),m=Number.toLocaleString?function(e){return e.toLocaleString(g)}:function(e){return e},_=f?function(e,t){n+=t?'<tr><td class="'+d+'">'+t+"</td>":'<tr><th class="'+d+'">#</th>',e.forEach((function(e,r){var i=x===r?' class="'+d+" "+v+'"':"",l=null===e?s:m(e);n+=t?"<td"+i+">"+l+"</td>":"<th"+i+">"+l+"</th>"})),n+="</tr>"}:function(e,t){n+="<tr>",e.forEach((function(e,r){var i=x===r?' class="'+d+" "+v+'"':"",l=null===e?s:m(e);n+=t?"<td"+i+">"+l+"</td>":"<th"+i+">"+l+"</th>"})),n+="</tr>"};if(!l(b))return null;var w=b.toTable({status:p,vlabel:u,slabel:c}),x=w[0].length-1;return w.forEach((function(e,t){_(e,t)})),b.source&&(a=b.length+1,f&&a++,p&&a++,"."!==(y+=": "+b.source).slice(-1)&&(y+="."),r='<tfoot><td colspan="'+a+'">'+y+"</td></tfoot>"),'<table class="'+h+'"><caption>'+(t.caption||b.label||"")+"</caption>"+r+"<tbody>"+n+"</tbody></table>"}function c(e,t){var n={};return Array.isArray(e[t])?(e[t].forEach((function(e,t){null!==e&&(n[String(t)]=e)})),n):e[t]}function f(e,t){if(void 0===e)return null;void 0===t&&(t={}),"boolean"!=typeof t.ovalue&&(t.ovalue=!1),"boolean"!=typeof t.ostatus&&(t.ostatus=!1),"boolean"!=typeof t.instance&&(t.instance=!1);var n=t.vlabel||"Value",i=t.slabel||"Status",l=t.type||"array",a=t.label||"",s=t.header||null,o=[],u=[],f=[],h=[],d={},v={},p=function(e,t){for(var n=1,r=0,i=0;i<x;i++)r+=(n*=i>0?t[x-i]:1)*e[x-i-1];return r},g=function(){var t=e[O][n];f[p(E,u)]=isNaN(t)?null:t};switch(l){case"array":e=function(e){for(var t=e[0],n=e.slice(1),r=[],i=0,l=n.length;i<l;i++){for(var a=0,s=t.length,o={};a<s;a++)o[t[a]]=n[i][a];r.push(o)}return r}(e);break;case"object":e=function(e){for(var t=e.cols.map((function(e){return e.id})),n=e.rows,r=[],i=0,l=n.length;i<l;i++){for(var a=0,s=t.length,o={};a<s;a++)o[t[a]]=n[i].c[a].v;r.push(o)}return r}(e)}var y,b=e.length;for(var m in t.hasOwnProperty("drop")&&Array.isArray(t.drop)&&t.drop.length&&e.forEach((function(e){t.drop.forEach((function(t){delete e[t]}))})),e[0])if(m!==n)if(m!==i){if(o.push(m),s)y=s.dimension[m],d[m]=y.category.index;else{d[m]=[];for(var _=0;_<b;_++){var w=e[_][m];-1===d[m].indexOf(w)&&d[m].push(w)}}u.push(d[m].length),v[m]={label:s?y.label:m,category:{index:d[m]}},s&&(v[m].category.label=y.category.label,y.category.unit&&(v[m].category.unit=y.category.unit))}else g=function(){var t=e[O][n],r=e[O][i];f[p(E,u)]=isNaN(t)?null:t,h[p(E,u)]=""===r?null:r};for(var x=o.length,O=0;O<b;O++){for(var E=[],A=0;A<x;A++){var D=o[A];E.push(d[D].indexOf(e[O][D]))}g()}var S={version:"2.0",class:"dataset",value:f,dimension:v,id:o,size:u};return a&&(S.label=a),h.length&&(S.status=h),s&&(s.label&&(S.label=s.label),s.source&&(S.source=s.source),s.updated&&(S.updated=s.updated),s.href&&(S.href=s.href),s.role&&(S.role=s.role)),t.ovalue&&(S.value=c(S,"value")),t.ostatus&&S.hasOwnProperty("status")&&(S.status=c(S,"status")),t.instance?r(S):S}function h(e,t){if(void 0===e)return null;void 0===t&&(t={});var n,r,i,l=[],a=null,s=null,o=!1,u={time:[],geo:[],metric:[]},c="jsonstat"===e.substring(0,8),h=c?"value":t.vlabel,d=c?"status":t.slabel,v=c?e.substring(8,9):t.delimiter||",",p=";"===v?t.decimal||",":t.decimal||".",g=function(e,t){t=t||",";for(var n,r,i=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),l=[[]],a=null;a=i.exec(e);)(r=a[1]).length&&r!=t&&l.push([]),n=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],l[l.length-1].push(n);return l}(e.trim(),v);if(c){for(p=g[0][1],i=g[0][2],g.shift();"data"!==g[0][0];)l.push(g.shift());g.shift(),s={dimension:{}},l.forEach((function(e){var t,n,r,l,a,c,f,h;switch(e[0]){case"dimension":if(s.dimension[e[1]]={},(l=s.dimension[e[1]]).label=e[2],l.category={},(a=l.category).index=[],n={},r=2*e[3]+3,e.length>=r){for(t=4;t<r;t++)f=e[t],h=e[++t],Object.defineProperty(n,f,{value:h,writable:!0,configurable:!0,enumerable:!0}),a.label=n,a.index.push(f);"string"==typeof e[t]&&-1!==["time","geo","metric"].indexOf(e[t])&&(u[e[t]].push(e[1]),o=!0,"metric"===e[t]&&"string"==typeof e[++t]&&(a.unit={},a.index.forEach((function(n,r){var l=e[t+r].split(i);a.unit[n]={},c=a.unit[n],void 0!==l[0]&&""!==l[0]&&(c.decimals=1*l[0]),void 0!==l[1]&&""!==l[1]&&(c.label=l[1]),void 0!==l[2]&&""!==l[2]&&(c.symbol=l[2]),void 0!==l[1]&&-1!==["start","end"].indexOf(l[3])&&(c.position=l[3])}))))}break;case"label":case"source":case"updated":case"href":s[e[0]]=e[1]||null}})),o&&(u.time.length||delete u.time,u.geo.length||delete u.geo,u.metric.length||delete u.metric,s.role=u)}if(n=g.length,r=g[0].length,void 0!==h){for(;r--;)if(g[0][r]===h){a=r;break}if(null===a)return null}else a=r-1,h=g[0][a];if(","===p)for(r=1;r<n;r++)g[r][a]=Number(g[r][a].replace(",","."));else for(r=1;r<n;r++)g[r][a]=Number(g[r][a]);return f(g,{header:s,vlabel:h,slabel:d,type:"array",label:t.label||"",ovalue:t.ovalue||!1,ostatus:t.ostatus||!1,instance:t.instance||!1})}function d(e,t){if("object"!=typeof e||!e.hasOwnProperty("dataSets")||!Array.isArray(e.dataSets))return null;if(1!==e.dataSets.length)return null;if(!e.dataSets[0].hasOwnProperty("observations"))return null;void 0===t?t={ovalue:!1,ostatus:!1,instance:!1}:("boolean"!=typeof t.ovalue&&(t.ovalue=!1),"boolean"!=typeof t.ostatus&&(t.ostatus=!1),"boolean"!=typeof t.instance&&(t.instance=!1));var n=e.structure,i=e.dataSets[0].observations,l=n.attributes.observation,a=n.dimensions;if(!a.hasOwnProperty("observation"))return null;if(a.hasOwnProperty("series")&&(null!==a.series||Object.keys(a.series).length))return null;var s=[],o=[],u={},c=[],f={time:[],geo:[]},h=function(){},d=function(e,t){for(var n=e.size,r=n.length-t.length;r--;)t.push(0);for(var i=0,l=n.length,a=0,s=1;i<l;i++)a+=(s*=i>0?n[l-i]:1)*t[l-i-1];return a},v=function(e){if(u[e.id]={label:e.name},e.hasOwnProperty("role"))switch(e.role){case"REF_AREA":f.geo.push(e.id);break;case"TIME_PERIOD":f.time.push(e.id)}Object.defineProperty(u[e.id],"category",{value:{index:[],label:{}},writable:!0,enumerable:!0}),s.push(e.id),o.push(e.values.length);var t=u[e.id].category;e.values.forEach((function(e){t.index.push(e.id),Object.defineProperty(t.label,e.id,{value:e.name,writable:!0,enumerable:!0})}))},p=e.header.links.find((function(e){return"request"===e.rel})),g=l.findIndex((function(e){return"OBS_STATUS"===e.id}));-1!==g&&(l[g].values.length?c=l[g].values:g=-1),a.observation.forEach(v),a.hasOwnProperty("dataSet")&&a.dataSet.forEach(v);var y,b={version:"2.0",class:"dataset",updated:e.header.prepared||null,source:e.header.sender.name||null,label:n.name||null,id:s,size:o,dimension:u,value:t.ovalue?{}:[]};for(var m in p&&(b.link={alternate:[{type:"application/vnd.sdmx.data+json",href:p.href}]}),f.geo.length+f.time.length>0&&(f.time.length||delete f.time,f.geo.length||delete f.geo,b.role=f),-1!==g&&(b.status=t.ostatus?{}:[],b.extension={status:{label:{}}},c.forEach((function(e){b.extension.status.label[e.id]=e.name})),h=t.ostatus?function(){var e=i[m][g];null!==e&&(b.status[d(b,_)]=c[e].id)}:function(){var e=i[m][g];b.status[d(b,_)]=null===e?null:c[e].id}),g++,i){var _=m.split(":");t.ovalue&&null===i[m][0]||(b.value[d(b,_)]=i[m][0]),h()}if(!t.ovalue)for(y=o.reduce((function(e,t){return e*t}))-b.value.length;y--;)b.value.push(null);if(!t.ostatus&&b.hasOwnProperty("status"))for(y=o.reduce((function(e,t){return e*t}))-b.status.length;y--;)b.status.push(null);return t.instance?r(b):b}function v(e,t){if(void 0===e||!Array.isArray(e))return null;var n=JSON.parse(JSON.stringify(e)),i=n[0];if(!i.hasOwnProperty("version")||!i.hasOwnProperty("class")||"dataset"!==i.class)return null;void 0===t&&(t={});var l=void 0===t.label?null:t.label,a=void 0===t.by?null:t.by,s=[];if(null===a){for(var o=1,u=n.length;o<u;o++)s=s.concat(n[o].value);return i.value=s,null!==l&&(i.label=l),i}var c,f,h,d=function(e,t,n){if(Array.isArray(e))e=e.concat(t);else for(var r in t)e[r]=0===t[r]?n:t[r];return e};n.forEach((function(e,t){var n=r(e).toTable({status:!0}),i=e.dimension[a].category;0===t?(s=[n[0]],c=i.index,f=i.label,h=i.unit):(c=d(c,i.index,t),f=d(f,i.label,t),h=d(h,i.unit,t)),s=s.concat(n.slice(1))}));var v=fromTable(s);return i.value=v.value,i.size=v.size,i.status=v.status||null,i.label=l||"",i.href=null,i.dimension[a].category.index=c||null,i.dimension[a].category.label=f||null,i.dimension[a].category.unit=h||null,i}function p(e,t){return null==e?"":-1!==e.indexOf(t)?'"'+e+'"':e}function g(e,t){if(void 0===e)return null;void 0===t&&(t={});var n="",r="jsonstat",a=!0===t.rich,s=a?"value":t.vlabel||"Value",o=a?"status":t.slabel||"Status",u=!0===t.status,c=t.na||"n/a",f=t.delimiter||",",h=t.separator||"|",d=";"===f?t.decimal||",":t.decimal||".",v=i(e,t.dsid||0);if(!l(v))return null;a&&(u=null!==v.status);var g=v.toTable({vlabel:s,slabel:o,status:u,field:a?"id":"label",content:a?"id":"label",type:"array"}),y=g[0].indexOf(s),b=u?g[0].indexOf(o):-1;return g.forEach((function(e,t){e.forEach((function(n,r){t&&r===y?null===n?e[r]=p(c,f):"."!==d&&(e[r]=String(e[r]).replace(".",d)):e[r]=t&&r===b&&null===n?"":p(e[r],f)})),n+=e.join(f)+"\n"})),a&&(r+=f+d+f+h+"\n",["label","source","updated","href"].forEach((function(e){v[e]&&(r+=e+f+p(v[e],f)+"\n")})),v.id.forEach((function(e,t){var n=[],i=v.Dimension(t),l=i.role,a=!1;r+="dimension"+f+p(e,f)+f+p(i.label,f)+f+i.length,"metric"===l&&i.__tree__.category.unit&&(a=!0),i.id.forEach((function(e,t){var l=[],s=i.Category(t);r+=f+p(e,f)+f+p(s.label,f),a&&(l.push(s.unit.hasOwnProperty("decimals")?s.unit.decimals:""),l.push(s.unit.label||""),s.unit.symbol&&(l.push(s.unit.symbol),l.push(s.unit.position)),n.push(p(l.join(h),f)))})),null!==l&&"classification"!==l&&(r+=f+i.role,a&&(r+=f+n.join(f))),r+="\n"})),n=r+"data\n"+n),n}t.prototype.Item=function(e){if(null===this||"collection"!==this.class||!this.length)return null;if("number"==typeof e)return e>this.length||e<0?null:this.link.item[e];var t,n=[];if("object"==typeof e){if(!e.class&&!e.follow)return null;e.class&&(t="dataset"===e.class&&"boolean"==typeof e.embedded?!0===e.embedded?function(e,t,r){var i=e.link.item[t];r.class===i.class&&i.id&&i.size&&i.dimension&&n.push(i)}:function(e,t,r){var i=e.link.item[t];r.class!==i.class||i.id&&i.size&&i.dimension||n.push(i)}:function(e,t,r){r.class===e.link.item[t].class&&n.push(e.link.item[t])})}else t=function(e,t){n.push(e.link.item[t])};for(var r=0;r<this.length;r++)t(this,r,e);return n},t.prototype.Dataset=function(e){if(null===this)return null;if("dataset"===this.class)return void 0!==e?this:[this];var n,r=[],i=0;if("collection"===this.class){var l=this.Item({class:"dataset",embedded:!0});if(void 0===e){for(n=l.length;i<n;i++)r.push(new t(l[i]));return r}if("number"==typeof e&&e>=0&&e<l.length)return new t(l[e]);if("string"==typeof e)for(n=l.length;i<n;i++)if(l[i].href===e)return new t(l[i]);return null}if("bundle"!==this.class)return null;if(void 0===e){for(n=this.id.length;i<n;i++)r.push(this.Dataset(this.id[i]));return r}if("number"==typeof e){var a=this.id[e];return void 0!==a?this.Dataset(a):null}var s=this.__tree__[e];return void 0===s?null:new t({class:"dataset",__tree__:s})},t.prototype.Dimension=function(e,n){n="boolean"!=typeof n||n;var r,i=[],l=this.id.length,a=function(e,t){if(null!==e)for(var n in e)for(var r=null!==e[n]?e[n].length:0;r--;)if(e[n][r]===t)return n;return null};if(null===this||"dataset"!==this.class)return null;if(void 0===e){for(r=0;r<l;r++)i.push(this.Dimension(this.id[r]));return i}if("number"==typeof e){var s=this.id[e];return void 0!==s?this.Dimension(s,n):null}var o=this.role;if("object"==typeof e){if(e.hasOwnProperty("role")){for(r=0;r<l;r++){var u=this.id[r];a(o,u)===e.role&&i.push(this.Dimension(u,n))}return void 0===i[0]?null:i}return null}var c=this.__tree__.dimension;if(void 0===c)return null;var f=c[e];return void 0===f?null:n?new t({class:"dimension",__tree__:f,role:a(o,e)}):function(e,t){var n=[];for(var r in e)n[e[r]]=t[r];return n}(f.category.index,f.category.label)},t.prototype.Category=function(e){if(null===this||"dimension"!==this.class)return null;if(void 0===e){for(var n=[],r=0,i=this.id.length;r<i;r++)n.push(this.Category(this.id[r]));return n}if("number"==typeof e){var l=this.id[e];return void 0!==l?this.Category(l):null}var a=this.__tree__.category;if(void 0===a)return null;var s=a.index[e];if(void 0===s)return null;var o=a.unit&&a.unit[e]||null,u=a.coordinates&&a.coordinates[e]||null,c=a.child&&a.child[e]||null,f=a.note&&a.note[e]||null;return new t({class:"category",index:s,label:a.label[e],note:f,child:c,unit:o,coord:u})},t.prototype.Slice=function(e){if(null===this||"dataset"!==this.class)return null;if(void 0===e)return this;if(!Array.isArray(e)){var t,n=[];for(t in e)n.push([t,e[t]]);e=n}var r=this,i=e.length,l=r.toTable({field:"id",content:"id",status:!0}),a=r.status,s=l.shift(),o=!1,u=[],c=[],f=[],h=[];return e.forEach((function(e){var t=r.Dimension(e[0]);if(null!==t){var n=t.id.indexOf(e[1]);-1!==n?(f.push([r.id.indexOf(e[0]),n]),h.push(t.Category(n).label)):o=!0}else o=!0})),o?null:(l.forEach((function(t){var n,r={},l=0;for(n=t.length;n--;)r[s[n]]=t[n];e.forEach((function(e){r[e[0]]===e[1]&&l++})),i===l&&(u.push(r.value),c.push(r.status))})),r.n=u.length,r.value=r.__tree__.value=u,r.status=r.__tree__.status=null!==a?c:null,e.forEach((function(e,t){r.size[f[t][0]]=1,r.__tree__.dimension[e[0]].category.index={},r.__tree__.dimension[e[0]].category.index[e[1]]=0,r.__tree__.dimension[e[0]].category.label={},r.__tree__.dimension[e[0]].category.label[e[1]]=h[t]})),r)},t.prototype.Data=function(e,t){var n,r,i=[],l=function(e){for(var t in e)if(e.hasOwnProperty(t))return t};if(null===this||"dataset"!==this.class)return null;if(void 0===e){for(r=this.value.length,n=0;n<r;n++)i.push(this.Data(n));return i}if("boolean"!=typeof t&&(t=!0),"number"==typeof e){var a=this.value[e];return void 0===a?null:t?{value:a,status:this.status?this.status[e]:null}:a}var s="object",o=this.__tree__,u=o.size||o.dimension&&o.dimension.size,c=u.length;if(Array.isArray(e)){if(!Array.isArray(e[0])){if(this.length!==e.length)return null;var f=1,h=0,d=[],v=[];for(n=0;n<c;n++)if(void 0!==e[n]){if("number"!=typeof e[n]||e[n]>=u[n])return null;h+=(f*=n>0?u[c-n]:1)*e[c-n-1]}else d.push(n),v.push(u[n]);if(d.length>1)return null;if(1===d.length){for(var p=0,g=v[0];p<g;p++){var y=[];for(n=0;n<c;n++)n!==d[0]?y.push(e[n]):y.push(p);i.push(this.Data(y,t))}return i}return t?{value:this.value[h],status:this.status?this.status[h]:null}:this.value[h]}s="array"}var b=function(e,t,n){var r,i=[],a={},s=e.dimension,o=e.id||s.id,u=e.size||s&&s.size;if("array"===n){for(r=t.length;r--;)a[t[r][0]]=t[r][1];t=a}for(var c=0,f=o.length;c<f;c++){var h=o[c],d=t[h];i.push("string"==typeof d?d:1===u[c]?l(s[h].category.index):null)}return i}(o,e,s),m=[],_=o.dimension,w=o.id||_.id;for(n=0,r=b.length;n<r;n++)m.push(_[w[n]].category.index[b[n]]);return this.Data(m,t)},t.prototype.toTable=function(e,t){if(null===this||"dataset"!==this.class)return null;1==arguments.length&&"function"==typeof e&&(t=e,e=null),e=e||{field:"label",content:"label",vlabel:"Value",slabel:"Status",type:"array",status:!1,unit:!1,by:null,prefix:"",drop:[],meta:!1,comma:!1,bylabel:!1};var n,r,i,l,a,s=this.__tree__,o=!0===e.status;if("function"==typeof t){n=this.toTable(e);var u=[],c="array"!==e.type?0:1;for(a=(z="object"!==e.type?n.slice(c):n.rows.slice(0)).length,r=0;r<a;r++){var f=t.call(this,z[r],r);void 0!==f&&u.push(f)}return"object"===e.type?{cols:n.cols,rows:u}:("array"===e.type&&u.unshift(n[0]),u)}if("arrobj"===e.type){var h=[],d=(n=this.toTable({field:"id",content:e.content,status:o})).shift(),v=s.role&&s.role.metric,p=function(){},g={},y=this,b=y.id,m=e.by&&-1!==b.indexOf(e.by)?e.by:null,_=!0===e.meta,w=void 0!==e.drop&&Array.isArray(e.drop)?e.drop:[],x=!0===e.comma,O=!0===e.bylabel,E=function(t){if(_){var n={};return b.forEach((function(e){var t=y.Dimension(e);n[e]={label:t.label,role:t.role,categories:{id:t.id,label:y.Dimension(e,!1)}}})),{meta:{label:y.label,source:y.source,updated:y.updated,id:b,status:o,unit:e.unit,by:m,bylabel:O,drop:null!==m&&w.length>0?w:null,prefix:null!==m?T||"":null,comma:x,dimensions:n},data:t}}return t};if(null===m&&e.unit&&v){if("id"!==e.content)for(var A=v.length;A--;){var D=this.Dimension(v[A]);g[v[A]]={};for(var S=D.length;S--;)g[v[A]][D.Category(S).label]=D.id[S]}p=function(t,n){if(-1!==v.indexOf(t)){var r=s.dimension[t].category;r.unit?P.unit=r.unit["id"!==e.content?g[t][n]:n]:P.unit=null}},e.unit=!0}else e.unit=!1;for(a=n.length,r=0;r<a;r++){var P={};for(i=n[r].length;i--;)P[d[i]]=n[r][i],p(d[i],n[r][i]);h.push(P)}if(x&&h.forEach((function(e){null!==e.value&&(e.value=(""+e.value).replace(".",","))})),null!==m){var k,j={},z=[],C={},T=void 0!==e.prefix?e.prefix:"";w.forEach((function(e,t){(!y.Dimension(e)||y.Dimension(e).length>1)&&(w[t]="")}));var N=b.filter((function(e){return e!==m&&-1===w.indexOf(e)})),R=y.Dimension(m),L=function(e,t){var n=[];return t.forEach((function(t){n.push(e[t])})),n.join("\t")},q=function(e,t){var n={};return t.forEach((function(t){n[t]=e[t]})),n};for(var J in"id"!==e.content?O?k=function(e,t,n){e[t][T+n[m]]=n.value}:(R.Category().forEach((function(e,t){C[e.label]=R.id[t]})),k=function(e,t,n){e[t][T+C[n[m]]]=n.value}):k=function(e,t,n){e[t][T+n[m]]=n.value},h.forEach((function(e){var t=L(e,N);void 0===j[t]&&(j[t]=q(e,N)),k(j,t,e,m)})),j)z.push(j[J]);return o=!1,E(z)}return E(h)}var F,I,V,U,M="id"===e.field;if("object"===e.type){var H="number"==typeof this.value[0]||null===this.value[0]?"number":"string";F=function(e,t){var n=M&&e||t||e;te.push({id:e,label:n,type:"string"})},I=function(e,t,n){var r=(M?"value":e)||"Value",i=(M?"status":t)||"Status";n&&te.push({id:"status",label:i,type:"string"}),te.push({id:"value",label:r,type:H})},V=function(e){ve.push({v:e})},U=function(e){ve.push({v:e}),ne.push({c:ve})}}else F=function(e,t){var n=M&&e||t||e;te.push(n)},I=function(e,t,n){var r=(M?"value":e)||"Value",i=(M?"status":t)||"Status";n&&te.push(i),te.push(r),ee.push(te)},V=function(e){ve.push(e)},U=function(e){ve.push(e),ee.push(ve)};var B=s.dimension,G=s.id||B.id,K=s.size||B.size,Q=G.length;if(Q!=K.length)return!1;var W=[],X=1,Y=(A=1,[]),Z=[],$=[],ee=[],te=[],ne=[];for(r=0;r<Q;r++){var re=G[r],ie=B[re].label;F(re,ie),X*=K[r],A*=K[r];var le=[];for(i=0;i<K[r];i++)for(var ae in B[G[r]].category.index)if(B[G[r]].category.index[ae]===i){var se="id"!==e.content&&B[G[r]].category.label?B[G[r]].category.label[ae]:ae;le.push(se)}W.push(le),Y.push(A)}for(I(e.vlabel,e.slabel,o),a=W.length,r=0;r<a;r++){for(var oe=[],ue=0,ce=W[r].length;ue<ce;ue++)for(var fe=0;fe<X/Y[r];fe++)oe.push(W[r][ue]);Z.push(oe)}for(a=Z.length,r=0;r<a;r++){var he=[],de=0;for(l=0;l<X;l++)he.push(Z[r][de]),++de===Z[r].length&&(de=0);$.push(he)}for(l=0;l<X;l++){var ve=[];a=Z.length;for(var pe=0;pe<a;pe++)V($[pe][l]);o&&V(this.status?this.status[l]:null),U(this.value[l])}return"object"===e.type?{cols:te,rows:ne}:ee},t.prototype.node=function(){return this.__tree__},t.prototype.toString=function(){return this.class},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var y="3.0.3";export{u as datalist,h as fromCSV,d as fromSDMX,f as fromTable,v as join,o as tbrowser,g as toCSV,y as version};
