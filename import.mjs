// jsonstat-suite v3.0.2 Copyright 2019 Xavier Badosa https://jsonstat.com
import e from"stream";import t from"http";import n from"url";import r from"https";import o from"zlib";const i=e.Readable,s=Symbol("buffer"),l=Symbol("type");class a{constructor(){this[l]="";const e=arguments[0],t=arguments[1],n=[];let r=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let i;r+=(i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof a?o[s]:Buffer.from("string"==typeof o?o:String(o))).length,n.push(i)}}this[s]=Buffer.concat(n);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[l]=o)}get size(){return this[s].length}get type(){return this[l]}text(){return Promise.resolve(this[s].toString())}arrayBuffer(){const e=this[s],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new i;return e._read=function(){},e.push(this[s]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,o;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const i=Math.max(o-r,0),l=this[s].slice(r,r+i),u=new a([],{type:arguments[2]});return u[s]=l,u}}function u(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let c;Object.defineProperties(a.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(a.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u.prototype.name="FetchError";try{c=require("encoding").convert}catch(V){}const f=Symbol("Body internals"),h=e.PassThrough;function d(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.size;let i=void 0===o?0:o;var s=r.timeout;let l=void 0===s?0:s;null==t?t=null:b(t)?t=Buffer.from(t.toString()):y(t)||Buffer.isBuffer(t)||("[object ArrayBuffer]"===Object.prototype.toString.call(t)?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof e||(t=Buffer.from(String(t)))),this[f]={body:t,disturbed:!1,error:null},this.size=i,this.timeout=l,t instanceof e&&t.on("error",(function(e){const t="AbortError"===e.name?e:new u(`Invalid response body while trying to fetch ${n.url}: ${e.message}`,"system",e);n[f].error=t}))}function p(){var t=this;if(this[f].disturbed)return d.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[f].disturbed=!0,this[f].error)return d.Promise.reject(this[f].error);let n=this.body;if(null===n)return d.Promise.resolve(Buffer.alloc(0));if(y(n)&&(n=n.stream()),Buffer.isBuffer(n))return d.Promise.resolve(n);if(!(n instanceof e))return d.Promise.resolve(Buffer.alloc(0));let r=[],o=0,i=!1;return new d.Promise((function(e,s){let l;t.timeout&&(l=setTimeout((function(){i=!0,s(new u(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout"))}),t.timeout)),n.on("error",(function(e){"AbortError"===e.name?(i=!0,s(e)):s(new u(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e))})),n.on("data",(function(e){if(!i&&null!==e){if(t.size&&o+e.length>t.size)return i=!0,void s(new u(`content size at ${t.url} over limit: ${t.size}`,"max-size"));o+=e.length,r.push(e)}})),n.on("end",(function(){if(!i){clearTimeout(l);try{e(Buffer.concat(r,o))}catch(e){s(new u(`Could not create Buffer from response body for ${t.url}: ${e.message}`,"system",e))}}}))}))}function b(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function y(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function v(t){let n,r,o=t.body;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof e&&"function"!=typeof o.getBoundary&&(n=new h,r=new h,o.pipe(n),o.pipe(r),t[f].body=n,o=r),o}function m(t){return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":b(t)?"application/x-www-form-urlencoded;charset=UTF-8":y(t)?t.type||null:Buffer.isBuffer(t)?null:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?null:ArrayBuffer.isView(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:t instanceof e?null:"text/plain;charset=UTF-8"}function g(e){const t=e.body;return null===t?0:y(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}d.prototype={get body(){return this[f].body},get bodyUsed(){return this[f].disturbed},arrayBuffer(){return p.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return p.call(this).then((function(t){return Object.assign(new a([],{type:e.toLowerCase()}),{[s]:t})}))},json(){var e=this;return p.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return d.Promise.reject(new u(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return p.call(this).then((function(e){return e.toString()}))},buffer(){return p.call(this)},textConverted(){var e=this;return p.call(this).then((function(t){return function(e,t){if("function"!=typeof c)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,o,i="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o))&&(r=/charset=(.*)/i.exec(r.pop()));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&("gb2312"!==(i=r.pop())&&"gbk"!==i||(i="gb18030"));return c(e,"UTF-8",i).toString()}(t,e.headers)}))}},Object.defineProperties(d.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),d.mixIn=function(e){for(const t of Object.getOwnPropertyNames(d.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(d.prototype,t);Object.defineProperty(e,t,n)}},d.Promise=global.Promise;const w=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,_=/[^\t\x20-\x7e\x80-\xff]/;function x(e){if(e=`${e}`,w.test(e)||""===e)throw new TypeError(`${e} is not a legal HTTP header name`)}function O(e){if(e=`${e}`,_.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function E(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const S=Symbol("map");class j{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[S]=Object.create(null),e instanceof j){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){x(e=`${e}`);const t=E(this[S],e);return void 0===t?null:this[S][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=P(this),r=0;for(;r<n.length;){var o=n[r];const i=o[0],s=o[1];e.call(t,s,i,this),n=P(this),r++}}set(e,t){t=`${t}`,x(e=`${e}`),O(t);const n=E(this[S],e);this[S][void 0!==n?n:e]=[t]}append(e,t){t=`${t}`,x(e=`${e}`),O(t);const n=E(this[S],e);void 0!==n?this[S][n].push(t):this[S][e]=[t]}has(e){return x(e=`${e}`),void 0!==E(this[S],e)}delete(e){x(e=`${e}`);const t=E(this[S],e);void 0!==t&&delete this[S][t]}raw(){return this[S]}keys(){return A(this,"key")}values(){return A(this,"value")}[Symbol.iterator](){return A(this,"key+value")}}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";return Object.keys(e[S]).sort().map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[S][t].join(", ")}:function(t){return[t.toLowerCase(),e[S][t].join(", ")]})}j.prototype.entries=j.prototype[Symbol.iterator],Object.defineProperty(j.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(j.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const T=Symbol("internal");function A(e,t){const n=Object.create(k);return n[T]={target:e,kind:t,index:0},n}const k=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==k)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[T];const t=e.target,n=e.kind,r=e.index,o=P(t,n);return r>=o.length?{value:void 0,done:!0}:(this[T].index=r+1,{value:o[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function z(e){const t=Object.assign({__proto__:null},e[S]),n=E(e[S],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(k,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const C=Symbol("Response internals"),D=t.STATUS_CODES;class B{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d.call(this,e,t);const n=t.status||200,r=new j(t.headers);if(null!=e&&!r.has("Content-Type")){const t=m(e);t&&r.append("Content-Type",t)}this[C]={url:t.url,status:n,statusText:t.statusText||D[n],headers:r,counter:t.counter}}get url(){return this[C].url||""}get status(){return this[C].status}get ok(){return this[C].status>=200&&this[C].status<300}get redirected(){return this[C].counter>0}get statusText(){return this[C].statusText}get headers(){return this[C].headers}clone(){return new B(v(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}d.mixIn(B.prototype),Object.defineProperties(B.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(B.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const L=Symbol("Request internals"),$=n.parse,R=n.format,U="destroy"in e.Readable.prototype;function N(e){return"object"==typeof e&&"object"==typeof e[L]}class q{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};N(e)?t=$(e.url):(t=e&&e.href?$(e.href):$(`${e}`),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||N(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=n.body?n.body:N(e)&&null!==e.body?v(e):null;d.call(this,o,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const i=new j(n.headers||e.headers||{});if(null!=o&&!i.has("Content-Type")){const e=m(o);e&&i.append("Content-Type",e)}let s=N(e)?e.signal:null;if("signal"in n&&(s=n.signal),null!=s&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[L]={method:r,redirect:n.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[L].method}get url(){return R(this[L].parsedURL)}get headers(){return this[L].headers}get redirect(){return this[L].redirect}get signal(){return this[L].signal}clone(){return new q(this)}}function F(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}d.mixIn(q.prototype),Object.defineProperty(q.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(q.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),F.prototype=Object.create(Error.prototype),F.prototype.constructor=F,F.prototype.name="AbortError";const H=e.PassThrough,I=n.resolve;function M(n,i){if(!M.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return d.Promise=M.Promise,new M.Promise((function(s,l){const a=new q(n,i),c=function(t){const n=t[L].parsedURL,r=new j(t[L].headers);if(r.has("Accept")||r.set("Accept","*/*"),!n.protocol||!n.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(n.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(t.signal&&t.body instanceof e.Readable&&!U)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==t.body&&/^(POST|PUT)$/i.test(t.method)&&(o="0"),null!=t.body){const e=g(t);"number"==typeof e&&(o=String(e))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let i=t.agent;return"function"==typeof i&&(i=i(n)),r.has("Connection")||i||r.set("Connection","close"),Object.assign({},n,{method:t.method,headers:z(r),agent:i})}(a),f=("https:"===c.protocol?r:t).request,h=a.signal;let d=null;const p=function(){let t=new F("The user aborted a request.");l(t),a.body&&a.body instanceof e.Readable&&a.body.destroy(t),d&&d.body&&d.body.emit("error",t)};if(h&&h.aborted)return void p();const b=function(){p(),x()},v=f(c);let m;function x(){v.abort(),h&&h.removeEventListener("abort",b),clearTimeout(m)}h&&h.addEventListener("abort",b),a.timeout&&v.once("socket",(function(e){m=setTimeout((function(){l(new u(`network timeout at: ${a.url}`,"request-timeout")),x()}),a.timeout)})),v.on("error",(function(e){l(new u(`request to ${a.url} failed, reason: ${e.message}`,"system",e)),x()})),v.on("response",(function(e){clearTimeout(m);const t=function(e){const t=new j;for(const n of Object.keys(e))if(!w.test(n))if(Array.isArray(e[n]))for(const r of e[n])_.test(r)||(void 0===t[S][n]?t[S][n]=[r]:t[S][n].push(r));else _.test(e[n])||(t[S][n]=[e[n]]);return t}(e.headers);if(M.isRedirect(e.statusCode)){const n=t.get("Location"),r=null===n?null:I(a.url,n);switch(a.redirect){case"error":return l(new u(`redirect mode is set to error: ${a.url}`,"no-redirect")),void x();case"manual":if(null!==r)try{t.set("Location",r)}catch(e){l(e)}break;case"follow":if(null===r)break;if(a.counter>=a.follow)return l(new u(`maximum redirect reached at: ${a.url}`,"max-redirect")),void x();const n={headers:new j(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:a.body,signal:a.signal,timeout:a.timeout};return 303!==e.statusCode&&a.body&&null===g(a)?(l(new u("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void x()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==a.method)||(n.method="GET",n.body=void 0,n.headers.delete("content-length")),s(M(new q(r,n))),void x())}}e.once("end",(function(){h&&h.removeEventListener("abort",b)}));let n=e.pipe(new H);const r={url:a.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:a.size,timeout:a.timeout,counter:a.counter},i=t.get("Content-Encoding");if(!a.compress||"HEAD"===a.method||null===i||204===e.statusCode||304===e.statusCode)return d=new B(n,r),void s(d);const c={flush:o.Z_SYNC_FLUSH,finishFlush:o.Z_SYNC_FLUSH};if("gzip"==i||"x-gzip"==i)return n=n.pipe(o.createGunzip(c)),d=new B(n,r),void s(d);if("deflate"!=i&&"x-deflate"!=i){if("br"==i&&"function"==typeof o.createBrotliDecompress)return n=n.pipe(o.createBrotliDecompress()),d=new B(n,r),void s(d);d=new B(n,r),s(d)}else{e.pipe(new H).once("data",(function(e){n=8==(15&e[0])?n.pipe(o.createInflate()):n.pipe(o.createInflateRaw()),d=new B(n,r),s(d)}))}})),function(e,t){const n=t.body;null===n?e.end():y(n)?n.stream().pipe(e):Buffer.isBuffer(n)?(e.write(n),e.end()):n.pipe(e)}(v,a)}))}M.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},M.Promise=global.Promise;var V="1.0.7";function J(e){var t,n,r,o,i=function(e,t){var n,r=[];if("string"==typeof e&&(e=[e]),Array.isArray(e)){if(e.length===t)return e;if(1===e.length){for(n=0;n<t;n++)r.push(e[0]);return r}}for(n=0;n<t;n++){var o=void 0===e[n]?null:e[n];r.push(o)}return r};if(this.length=0,this.id=[],null!=e)switch(this.class=e.class||"bundle",this.class){case"bundle":var s=[],l=0;if(this.error=null,this.length=0,null===e||"object"!=typeof e)return void(this.class=null);if(e.hasOwnProperty("error"))return void(this.error=e.error);if("dataset"===e.class||"collection"===e.class||"dimension"===e.class)return new J(e);for(n in e)l++,s.push(n);this.__tree__=e,this.length=l,this.id=s;break;case"dataset":e.hasOwnProperty("__tree__")?this.__tree__=t=e.__tree__:this.__tree__=t=e,this.label=t.label||null,this.note=t.note||null,this.link=t.link||null,this.href=t.href||null,this.updated=t.updated||null,this.source=t.source||null,this.extension=t.extension||null;var a,u=0,c=t.size||t.dimension&&t.dimension.size;if(this.size=c,t.hasOwnProperty("value")&&Array.isArray(t.value))u=t.value.length;else{var f=1;for(a=c.length;a--;)f*=c[a];u=f}if(this.value=i(t.value,u),this.status=t.hasOwnProperty("status")?i(t.status,u):null,t.hasOwnProperty("dimension")){var h=t.dimension,d=t.role||!t.version&&h.role||null,p=t.id||h.id,b=c.length,y=function(e){d.hasOwnProperty(e)||(d[e]=null)};if(!Array.isArray(p)||!Array.isArray(c)||p.length!=b)return;if(this.length=b,this.id=p,d&&(y("time"),y("geo"),y("metric"),y("classification")),d&&null===d.classification){var v=[],m=["time","geo","metric"],g=function(e,t){for(var n=t.length;n--;)if(e===t[n])return!0;return!1};for(a=0;a<3;a++){var w=d[m[a]];null!==w&&(v=v.concat(w))}for(d.classification=[],a=0;a<b;a++)g(p[a],v)||d.classification.push(p[a]);0===d.classification.length&&(d.classification=null)}this.role=d,this.n=u;for(var _=0,x=this.length;_<x;_++)if(h[p[_]].category.hasOwnProperty("index")){if(Array.isArray(h[p[_]].category.index)){var O={},E=h[p[_]].category.index;for(r=E.length,o=0;o<r;o++)O[E[o]]=o;h[p[_]].category.index=O}}else{var S=0;for(n in h[p[_]].category.index={},h[p[_]].category.label)h[p[_]].category.index[n]=S++}}else this.length=0;break;case"dimension":if(!e.hasOwnProperty("__tree__"))return new J({version:"2.0",class:"dataset",dimension:{d:e},id:["d"],size:[function(e){var t=void 0===e.index?e.label:e.index;return Array.isArray(t)?t.length:Object.keys(t).length}(e.category)],value:[null]}).Dimension(0);var j=[],P=(t=e.__tree__).category;if(!t.hasOwnProperty("category"))return;if(!P.hasOwnProperty("label"))for(n in P.label={},P.index)P.label[n]=n;for(n in P.index)j[P.index[n]]=n;this.__tree__=t,this.label=t.label||null,this.note=t.note||null,this.link=t.link||null,this.href=t.href||null,this.id=j,this.length=j.length,this.role=e.role,this.hierarchy=P.hasOwnProperty("child"),this.extension=t.extension||null;break;case"category":var T=e.child;this.id=T,this.length=null===T?0:T.length,this.index=e.index,this.label=e.label,this.note=e.note||null,this.unit=e.unit,this.coordinates=e.coord;break;case"collection":if(this.length=0,this.label=e.label||null,this.note=e.note||null,this.link=e.link||null,this.href=e.href||null,this.updated=e.updated||null,this.source=e.source||null,this.extension=e.extension||null,null!==this.link&&e.link.item){var A=e.link.item;if(this.length=Array.isArray(A)?A.length:0,this.length)for(o=0;o<this.length;o++)this.id[o]=A[o].href}}}function G(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.json()}function Z(e,t){return"object"==typeof e?new J(e):"version"===e?V:M?M(e,t).then(G).then((function(e){return new J(e)})):void 0}function K(e,t){return null==e?null:("string"!=typeof e&&void 0!==e.length||(e=Z(e)),0===e.length||"dataset"!==e.class&&"collection"!==e.class&&"bundle"!==e.class?null:"dataset"===e.class?e:e.Dataset(t))}function Y(e){if(null===e||0===e.length||"dataset"!==e.class)return!1;for(var t=e.length,n=1;t--;)n*=e.Dimension(t).length;return n===e.n}function Q(e,t,n){var r,o,i,s,l;return(t.label||n).capitalize()+(o=t,l="",(r=e)&&"metric"===r.role&&o.unit&&(i=o.unit.hasOwnProperty("label")?o.unit.label:"")+(s=o.unit.hasOwnProperty("symbol")?o.unit.symbol:"")!==""&&(l=" ("+(l=""===s?i:""===i?s:"start"===o.unit.position?s+i:i+" "+s)+")"),l)}function W(e,t,n){var r,o='<select name="'+t+'">',i=[];if(null!==n[1]){if(r=e.id,i=e.Dimension(),2===r.length)return(e.Dimension(n[0]).label||n[0]).capitalize()}else{var s=e.Dimension(t);if(r=s.id,i=s.Category(),1===r.length)return}return r.forEach((function(e,t){var r=e!==n[0]?"":'selected="selected" ';null!==n[1]&&e===n[1]||(o+="<option "+r+'value="'+e+'">'+Q(s,i[t],e)+"</option>")})),o+="</select>"}function X(e,t,n){function r(e){void 0!==t?t.innerHTML=o[e]:window.alert(o[e])}if(void 0!==e)if(void 0!==t){void 0===n&&(n={});var o=void 0===n.i18n||void 0===n.i18n.msgs?{urierror:"tbrowser: A valid JSON-stat input must be specified.",selerror:"tbrowser: A valid selector must be specified.",jsonerror:"The request did not return a valid JSON-stat dataset.",dimerror:"Only one dimension was found in the dataset. At least two are required.",dataerror:"Selection returned no data!",source:"Source",filters:"Filters",constants:"Constants",rc:"Rows &amp; Columns",na:"n/a"}:n.i18n.msgs,i=void 0===n.i18n||void 0===n.i18n.locale?"en-US":n.i18n.locale,s=n.dsid||0,l=n.status||!1,a=n.tblclass||"",u=n.nonconst||!1,c=K(e,s);if(Y(c)){if(u)var f=function(e){var t=0,n=e.size.slice(0),r=[];return n.forEach((function(n,o){var i=o-t,s=e.Dimension(i);1===n&&(delete e.__tree__.dimension[e.id[i]],e.size.splice(i,1),e.id.splice(i,1),e.length--,t++,r.push(s.label.capitalize()+": "+s.Category(0).label.capitalize()))})),r}(c);1!==c.length?function e(t,n,r,s){var a="",c="",h="",d="",p=r.rows,b=n.Dimension(p),y=b.id,v=r.cols,m=n.Dimension(v),g=m.id,w=n.role&&n.role.metric?n.role.metric[0]:null,_=null!==w?n.Dimension(w):null,x=function(e){return e.hasOwnProperty("unit")&&e.unit&&e.unit.hasOwnProperty("decimals")?e.unit.decimals:null},O=r.filter,E=JSON.parse(JSON.stringify(O)),S=[],j="",P="",T=n.source?o.source+": "+n.source:"",A=null!==n.label?'<span class="label">'+n.label.capitalize()+"</span>":"";for(var k in u&&f.length&&(A='<span class="label">'+f.join(". ")+"</span>"),""!==T&&"."!==T.slice(-1)&&(T+="."),h+="<caption>"+A+"<form>",O){var z=n.Dimension(k),C=z.label?z.label.capitalize():k.capitalize();z.length>1?j+="<p>"+W(n,k,[O[k],null])+" <strong>"+C+"</strong></p>":S.push({label:C,value:Q(z,z.Category(0)),name:k,id:z.id[0]})}""!==j&&(j='<fieldset id="filters"><legend>'+o.filters+"</legend>"+j+"</fieldset>"),S.forEach((function(e){P+="<p>"+e.value+" <strong>"+e.label+'</strong></p><input type="hidden" name="'+e.name+'" value="'+e.id+'" />'})),""!==P&&(P='<fieldset id="constants"><legend>'+o.constants+"</legend>"+P+"</fieldset>"),h+=P+j+'<fieldset id="rowscols"><legend>'+o.rc+"</legend>"+W(n,"rows",[p,v])+" <a>&#x2194;</a> "+W(n,"cols",[v,p])+"</fieldset></form></caption>",d+="<tbody>";var D=Number.toLocaleString?function(e,t){return null===t?e.toLocaleString(i):e.toLocaleString(i,{minimumFractionDigits:t,maximumFractionDigits:t})}:function(e,t){return null===t?e:e.toFixed(t)};if(y.forEach((function(e){E[p]=e;var t=n.Data(E),r=function(e,t){var n,r=v!==w?null===_?null:x(_.Category(E[w])):x(m.Category(t));null!==e.value?(n=D(e.value,r),l&&null!==e.status&&(n+=" ("+e.status+")")):n=e.status||o.na,d+="<td>"+n+"</td>"};null!==t?(d+='<tr><th scope="row">'+Q(b,b.Category(e))+"</th>",Array.isArray(t)?t.forEach((function(e,t){r(e,t)})):r(t,0),d+="</tr>"):d="ERROR"})),"ERROR"===d)return o.dataerror;d+="</tbody>",a+="<thead><tr><th></th>",g.forEach((function(e){a+='<th scope="col">'+Q(m,m.Category(e))+"</th>"})),a+="</tr></thead>",""!==T&&(c='<tfoot><tr><td colspan="'+(g.length+1)+'">'+T+"</td></tr></tfoot>"),t.innerHTML='<table class="'+s+'">'+h+a+c+d+"</table>",[].slice.call(t.querySelectorAll("select")).forEach((function(r){r.addEventListener("change",(function(r){var o,i;e(t,n,function(e,t,n){var r={filter:{}};return n.forEach((function(e){"rows"===e.name||"cols"===e.name?r[e.name]=e.value:r.filter[e.name]=e.value})),"rowscols"===t&&e.id.forEach((function(t,n){t!==r.rows&&t!==r.cols?void 0===r.filter[t]&&(r.filter[t]=e.Dimension(n).id[0]):delete r.filter[t]})),r}(n,r.target.parentElement.getAttribute("id"),(o=t,i=[],[].slice.call(o.querySelectorAll("select, input")).forEach((function(e){i.push({name:e.name,value:e.value})})),i)),s)}),!1)})),t.querySelector("a").addEventListener("click",(function(){r.cols=p,r.rows=v,e(t,n,r,s)}),!1)}(t,c,function(e,t){var n,r,o={},i=[],s=e.id;if(t){var l="bigger"===t?function(e,t){return e.len<t.len?1:-1}:function(e,t){return e.len>t.len?1:-1};e.Dimension().forEach((function(e,t){i.push({id:s[t],len:e.length})})),i.sort(l),n=i[0].id,r=i[1].id}else n=s[0],r=s[1];return e.Dimension(n).length<e.Dimension(r).length&&(n=r+(r=n,"")),s.forEach((function(t){t!==n&&t!==r&&(o[t]=e.Dimension(t).id[0])})),{rows:n,cols:r,filter:o}}(c,n.preset),a):r("dimerror")}else r("jsonerror")}else r("selerror");else r("urierror")}function ee(e,t){if(void 0===e)return null;void 0===t&&(t={});var n="",r="",o=0,i=t.na||"n/a",s=t.dsid||0,l=t.vlabel||null,a=t.slabel||null,u=t.counter||!1,c=t.tblclass||"",f=t.numclass||"",h=t.valclass||"",d=t.status||!1,p=t.locale||"en-US",b=t.source||"Source",y=K(e,s),v=Number.toLocaleString?function(e){return e.toLocaleString(p)}:function(e){return e},m=u?function(e,t){n+=t?'<tr><td class="'+f+'">'+t+"</td>":'<tr><th class="'+f+'">#</th>',e.forEach((function(e,r){var o=w===r?' class="'+f+" "+h+'"':"",s=null===e?i:v(e);n+=t?"<td"+o+">"+s+"</td>":"<th"+o+">"+s+"</th>"})),n+="</tr>"}:function(e,t){n+="<tr>",e.forEach((function(e,r){var o=w===r?' class="'+f+" "+h+'"':"",s=null===e?i:v(e);n+=t?"<td"+o+">"+s+"</td>":"<th"+o+">"+s+"</th>"})),n+="</tr>"};if(!Y(y))return null;var g=y.toTable({status:d,vlabel:l,slabel:a}),w=g[0].length-1;return g.forEach((function(e,t){m(e,t)})),y.source&&(o=y.length+1,u&&o++,d&&o++,"."!==(b+=": "+y.source).slice(-1)&&(b+="."),r='<tfoot><td colspan="'+o+'">'+b+"</td></tfoot>"),'<table class="'+c+'"><caption>'+(t.caption||y.label||"")+"</caption>"+r+"<tbody>"+n+"</tbody></table>"}function te(e,t){var n={};return Array.isArray(e[t])?(e[t].forEach((function(e,t){null!==e&&(n[String(t)]=e)})),n):e[t]}function ne(e,t){if(void 0===e)return null;void 0===t&&(t={}),"boolean"!=typeof t.ovalue&&(t.ovalue=!1),"boolean"!=typeof t.ostatus&&(t.ostatus=!1),"boolean"!=typeof t.instance&&(t.instance=!1);var n=t.vlabel||"Value",r=t.slabel||"Status",o=t.type||"array",i=t.label||"",s=t.header||null,l=[],a=[],u=[],c=[],f={},h={},d=function(e,t){for(var n=1,r=0,o=0;o<w;o++)r+=(n*=o>0?t[w-o]:1)*e[w-o-1];return r},p=function(){var t=e[_][n];u[d(x,a)]=isNaN(t)?null:t};switch(o){case"array":e=function(e){for(var t=e[0],n=e.slice(1),r=[],o=0,i=n.length;o<i;o++){for(var s=0,l=t.length,a={};s<l;s++)a[t[s]]=n[o][s];r.push(a)}return r}(e);break;case"object":e=function(e){for(var t=e.cols.map((function(e){return e.id})),n=e.rows,r=[],o=0,i=n.length;o<i;o++){for(var s=0,l=t.length,a={};s<l;s++)a[t[s]]=n[o].c[s].v;r.push(a)}return r}(e)}var b,y=e.length;for(var v in t.hasOwnProperty("drop")&&Array.isArray(t.drop)&&t.drop.length&&e.forEach((function(e){t.drop.forEach((function(t){delete e[t]}))})),e[0])if(v!==n)if(v!==r){if(l.push(v),s)b=s.dimension[v],f[v]=b.category.index;else{f[v]=[];for(var m=0;m<y;m++){var g=e[m][v];-1===f[v].indexOf(g)&&f[v].push(g)}}a.push(f[v].length),h[v]={label:s?b.label:v,category:{index:f[v]}},s&&(h[v].category.label=b.category.label,b.category.unit&&(h[v].category.unit=b.category.unit))}else p=function(){var t=e[_][n],o=e[_][r];u[d(x,a)]=isNaN(t)?null:t,c[d(x,a)]=""===o?null:o};for(var w=l.length,_=0;_<y;_++){for(var x=[],O=0;O<w;O++){var E=l[O];x.push(f[E].indexOf(e[_][E]))}p()}var S={version:"2.0",class:"dataset",value:u,dimension:h,id:l,size:a};return i&&(S.label=i),c.length&&(S.status=c),s&&(s.label&&(S.label=s.label),s.source&&(S.source=s.source),s.updated&&(S.updated=s.updated),s.href&&(S.href=s.href),s.role&&(S.role=s.role)),t.ovalue&&(S.value=te(S,"value")),t.ostatus&&S.hasOwnProperty("status")&&(S.status=te(S,"status")),t.instance?Z(S):S}function re(e,t){if(void 0===e)return null;void 0===t&&(t={});var n,r,o,i=[],s=null,l=null,a=!1,u={time:[],geo:[],metric:[]},c="jsonstat"===e.substring(0,8),f=c?"value":t.vlabel,h=c?"status":t.slabel,d=c?e.substring(8,9):t.delimiter||",",p=";"===d?t.decimal||",":t.decimal||".",b=function(e,t){t=t||",";for(var n,r,o=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),i=[[]],s=null;s=o.exec(e);)(r=s[1]).length&&r!=t&&i.push([]),n=s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3],i[i.length-1].push(n);return i}(e.trim(),d);if(c){for(p=b[0][1],o=b[0][2],b.shift();"data"!==b[0][0];)i.push(b.shift());b.shift(),l={dimension:{}},i.forEach((function(e){var t,n,r,i,s,c,f,h;switch(e[0]){case"dimension":if(l.dimension[e[1]]={},(i=l.dimension[e[1]]).label=e[2],i.category={},(s=i.category).index=[],n={},r=2*e[3]+3,e.length>=r){for(t=4;t<r;t++)f=e[t],h=e[++t],Object.defineProperty(n,f,{value:h,writable:!0,configurable:!0,enumerable:!0}),s.label=n,s.index.push(f);"string"==typeof e[t]&&-1!==["time","geo","metric"].indexOf(e[t])&&(u[e[t]].push(e[1]),a=!0,"metric"===e[t]&&"string"==typeof e[++t]&&(s.unit={},s.index.forEach((function(n,r){var i=e[t+r].split(o);s.unit[n]={},c=s.unit[n],void 0!==i[0]&&""!==i[0]&&(c.decimals=1*i[0]),void 0!==i[1]&&""!==i[1]&&(c.label=i[1]),void 0!==i[2]&&""!==i[2]&&(c.symbol=i[2]),void 0!==i[1]&&-1!==["start","end"].indexOf(i[3])&&(c.position=i[3])}))))}break;case"label":case"source":case"updated":case"href":l[e[0]]=e[1]||null}})),a&&(u.time.length||delete u.time,u.geo.length||delete u.geo,u.metric.length||delete u.metric,l.role=u)}if(n=b.length,r=b[0].length,void 0!==f){for(;r--;)if(b[0][r]===f){s=r;break}if(null===s)return null}else s=r-1,f=b[0][s];if(","===p)for(r=1;r<n;r++)b[r][s]=Number(b[r][s].replace(",","."));else for(r=1;r<n;r++)b[r][s]=Number(b[r][s]);return ne(b,{header:l,vlabel:f,slabel:h,type:"array",label:t.label||"",ovalue:t.ovalue||!1,ostatus:t.ostatus||!1,instance:t.instance||!1})}function oe(e,t){if("object"!=typeof e||!e.hasOwnProperty("dataSets")||!Array.isArray(e.dataSets))return null;if(1!==e.dataSets.length)return null;if(!e.dataSets[0].hasOwnProperty("observations"))return null;void 0===t?t={ovalue:!1,ostatus:!1,instance:!1}:("boolean"!=typeof t.ovalue&&(t.ovalue=!1),"boolean"!=typeof t.ostatus&&(t.ostatus=!1),"boolean"!=typeof t.instance&&(t.instance=!1));var n=e.structure,r=e.dataSets[0].observations,o=n.attributes.observation,i=n.dimensions;if(!i.hasOwnProperty("observation"))return null;if(i.hasOwnProperty("series")&&(null!==i.series||Object.keys(i.series).length))return null;var s=[],l=[],a={},u=[],c={time:[],geo:[]},f=function(){},h=function(e,t){for(var n=e.size,r=n.length-t.length;r--;)t.push(0);for(var o=0,i=n.length,s=0,l=1;o<i;o++)s+=(l*=o>0?n[i-o]:1)*t[i-o-1];return s},d=function(e){if(a[e.id]={label:e.name},e.hasOwnProperty("role"))switch(e.role){case"REF_AREA":c.geo.push(e.id);break;case"TIME_PERIOD":c.time.push(e.id)}Object.defineProperty(a[e.id],"category",{value:{index:[],label:{}},writable:!0,enumerable:!0}),s.push(e.id),l.push(e.values.length);var t=a[e.id].category;e.values.forEach((function(e){t.index.push(e.id),Object.defineProperty(t.label,e.id,{value:e.name,writable:!0,enumerable:!0})}))},p=e.header.links.find((function(e){return"request"===e.rel})),b=o.findIndex((function(e){return"OBS_STATUS"===e.id}));-1!==b&&(o[b].values.length?u=o[b].values:b=-1),i.observation.forEach(d),i.hasOwnProperty("dataSet")&&i.dataSet.forEach(d);var y,v={version:"2.0",class:"dataset",updated:e.header.prepared||null,source:e.header.sender.name||null,label:n.name||null,id:s,size:l,dimension:a,value:t.ovalue?{}:[]};for(var m in p&&(v.link={alternate:[{type:"application/vnd.sdmx.data+json",href:p.href}]}),c.geo.length+c.time.length>0&&(c.time.length||delete c.time,c.geo.length||delete c.geo,v.role=c),-1!==b&&(v.status=t.ostatus?{}:[],v.extension={status:{label:{}}},u.forEach((function(e){v.extension.status.label[e.id]=e.name})),f=t.ostatus?function(){var e=r[m][b];null!==e&&(v.status[h(v,g)]=u[e].id)}:function(){var e=r[m][b];v.status[h(v,g)]=null===e?null:u[e].id}),b++,r){var g=m.split(":");t.ovalue&&null===r[m][0]||(v.value[h(v,g)]=r[m][0]),f()}if(!t.ovalue)for(y=l.reduce((function(e,t){return e*t}))-v.value.length;y--;)v.value.push(null);if(!t.ostatus&&v.hasOwnProperty("status"))for(y=l.reduce((function(e,t){return e*t}))-v.status.length;y--;)v.status.push(null);return t.instance?Z(v):v}function ie(e,t){if(void 0===e||!Array.isArray(e))return null;var n=JSON.parse(JSON.stringify(e)),r=n[0];if(!r.hasOwnProperty("version")||!r.hasOwnProperty("class")||"dataset"!==r.class)return null;void 0===t&&(t={});var o=void 0===t.label?null:t.label,i=void 0===t.by?null:t.by,s=[];if(null===i){for(var l=1,a=n.length;l<a;l++)s=s.concat(n[l].value);return r.value=s,null!==o&&(r.label=o),r}var u,c,f,h=function(e,t,n){if(Array.isArray(e))e=e.concat(t);else for(var r in t)e[r]=0===t[r]?n:t[r];return e};n.forEach((function(e,t){var n=Z(e).toTable({status:!0}),r=e.dimension[i].category;0===t?(s=[n[0]],u=r.index,c=r.label,f=r.unit):(u=h(u,r.index,t),c=h(c,r.label,t),f=h(f,r.unit,t)),s=s.concat(n.slice(1))}));var d=fromTable(s);return r.value=d.value,r.size=d.size,r.status=d.status||null,r.label=o||"",r.href=null,r.dimension[i].category.index=u||null,r.dimension[i].category.label=c||null,r.dimension[i].category.unit=f||null,r}function se(e,t){return null==e?"":-1!==e.indexOf(t)?'"'+e+'"':e}function le(e,t){if(void 0===e)return null;void 0===t&&(t={});var n="",r="jsonstat",o=!0===t.rich,i=o?"value":t.vlabel||"Value",s=o?"status":t.slabel||"Status",l=!0===t.status,a=t.na||"n/a",u=t.delimiter||",",c=t.separator||"|",f=";"===u?t.decimal||",":t.decimal||".",h=K(e,t.dsid||0);if(!Y(h))return null;o&&(l=null!==h.status);var d=h.toTable({vlabel:i,slabel:s,status:l,field:o?"id":"label",content:o?"id":"label",type:"array"}),p=d[0].indexOf(i),b=l?d[0].indexOf(s):-1;return d.forEach((function(e,t){e.forEach((function(n,r){t&&r===p?null===n?e[r]=se(a,u):"."!==f&&(e[r]=String(e[r]).replace(".",f)):e[r]=t&&r===b&&null===n?"":se(e[r],u)})),n+=e.join(u)+"\n"})),o&&(r+=u+f+u+c+"\n",["label","source","updated","href"].forEach((function(e){h[e]&&(r+=e+u+se(h[e],u)+"\n")})),h.id.forEach((function(e,t){var n=[],o=h.Dimension(t),i=o.role,s=!1;r+="dimension"+u+se(e,u)+u+se(o.label,u)+u+o.length,"metric"===i&&o.__tree__.category.unit&&(s=!0),o.id.forEach((function(e,t){var i=[],l=o.Category(t);r+=u+se(e,u)+u+se(l.label,u),s&&(i.push(l.unit.hasOwnProperty("decimals")?l.unit.decimals:""),i.push(l.unit.label||""),l.unit.symbol&&(i.push(l.unit.symbol),i.push(l.unit.position)),n.push(se(i.join(c),u)))})),null!==i&&"classification"!==i&&(r+=u+o.role,s&&(r+=u+n.join(u))),r+="\n"})),n=r+"data\n"+n),n}J.prototype.Item=function(e){if(null===this||"collection"!==this.class||!this.length)return null;if("number"==typeof e)return e>this.length||e<0?null:this.link.item[e];var t,n=[];if("object"==typeof e){if(!e.class&&!e.follow)return null;e.class&&(t="dataset"===e.class&&"boolean"==typeof e.embedded?!0===e.embedded?function(e,t,r){var o=e.link.item[t];r.class===o.class&&o.id&&o.size&&o.dimension&&n.push(o)}:function(e,t,r){var o=e.link.item[t];r.class!==o.class||o.id&&o.size&&o.dimension||n.push(o)}:function(e,t,r){r.class===e.link.item[t].class&&n.push(e.link.item[t])})}else t=function(e,t){n.push(e.link.item[t])};for(var r=0;r<this.length;r++)t(this,r,e);return n},J.prototype.Dataset=function(e){if(null===this)return null;if("dataset"===this.class)return void 0!==e?this:[this];var t,n=[],r=0;if("collection"===this.class){var o=this.Item({class:"dataset",embedded:!0});if(void 0===e){for(t=o.length;r<t;r++)n.push(new J(o[r]));return n}if("number"==typeof e&&e>=0&&e<o.length)return new J(o[e]);if("string"==typeof e)for(t=o.length;r<t;r++)if(o[r].href===e)return new J(o[r]);return null}if("bundle"!==this.class)return null;if(void 0===e){for(t=this.id.length;r<t;r++)n.push(this.Dataset(this.id[r]));return n}if("number"==typeof e){var i=this.id[e];return void 0!==i?this.Dataset(i):null}var s=this.__tree__[e];return void 0===s?null:new J({class:"dataset",__tree__:s})},J.prototype.Dimension=function(e,t){t="boolean"!=typeof t||t;var n,r=[],o=this.id.length,i=function(e,t){if(null!==e)for(var n in e)for(var r=null!==e[n]?e[n].length:0;r--;)if(e[n][r]===t)return n;return null};if(null===this||"dataset"!==this.class)return null;if(void 0===e){for(n=0;n<o;n++)r.push(this.Dimension(this.id[n]));return r}if("number"==typeof e){var s=this.id[e];return void 0!==s?this.Dimension(s,t):null}var l=this.role;if("object"==typeof e){if(e.hasOwnProperty("role")){for(n=0;n<o;n++){var a=this.id[n];i(l,a)===e.role&&r.push(this.Dimension(a,t))}return void 0===r[0]?null:r}return null}var u=this.__tree__.dimension;if(void 0===u)return null;var c=u[e];return void 0===c?null:t?new J({class:"dimension",__tree__:c,role:i(l,e)}):function(e,t){var n=[];for(var r in e)n[e[r]]=t[r];return n}(c.category.index,c.category.label)},J.prototype.Category=function(e){if(null===this||"dimension"!==this.class)return null;if(void 0===e){for(var t=[],n=0,r=this.id.length;n<r;n++)t.push(this.Category(this.id[n]));return t}if("number"==typeof e){var o=this.id[e];return void 0!==o?this.Category(o):null}var i=this.__tree__.category;if(void 0===i)return null;var s=i.index[e];if(void 0===s)return null;var l=i.unit&&i.unit[e]||null,a=i.coordinates&&i.coordinates[e]||null,u=i.child&&i.child[e]||null,c=i.note&&i.note[e]||null;return new J({class:"category",index:s,label:i.label[e],note:c,child:u,unit:l,coord:a})},J.prototype.Slice=function(e){if(null===this||"dataset"!==this.class)return null;if(void 0===e)return this;if(!Array.isArray(e)){var t,n=[];for(t in e)n.push([t,e[t]]);e=n}var r=this,o=e.length,i=r.toTable({field:"id",content:"id",status:!0}),s=r.status,l=i.shift(),a=!1,u=[],c=[],f=[],h=[];return e.forEach((function(e){var t=r.Dimension(e[0]);if(null!==t){var n=t.id.indexOf(e[1]);-1!==n?(f.push([r.id.indexOf(e[0]),n]),h.push(t.Category(n).label)):a=!0}else a=!0})),a?null:(i.forEach((function(t){var n,r={},i=0;for(n=t.length;n--;)r[l[n]]=t[n];e.forEach((function(e){r[e[0]]===e[1]&&i++})),o===i&&(u.push(r.value),c.push(r.status))})),r.n=u.length,r.value=r.__tree__.value=u,r.status=r.__tree__.status=null!==s?c:null,e.forEach((function(e,t){r.size[f[t][0]]=1,r.__tree__.dimension[e[0]].category.index={},r.__tree__.dimension[e[0]].category.index[e[1]]=0,r.__tree__.dimension[e[0]].category.label={},r.__tree__.dimension[e[0]].category.label[e[1]]=h[t]})),r)},J.prototype.Data=function(e,t){var n,r,o=[],i=function(e){for(var t in e)if(e.hasOwnProperty(t))return t};if(null===this||"dataset"!==this.class)return null;if(void 0===e){for(r=this.value.length,n=0;n<r;n++)o.push(this.Data(n));return o}if("boolean"!=typeof t&&(t=!0),"number"==typeof e){var s=this.value[e];return void 0===s?null:t?{value:s,status:this.status?this.status[e]:null}:s}var l="object",a=this.__tree__,u=a.size||a.dimension&&a.dimension.size,c=u.length;if(Array.isArray(e)){if(!Array.isArray(e[0])){if(this.length!==e.length)return null;var f=1,h=0,d=[],p=[];for(n=0;n<c;n++)if(void 0!==e[n]){if("number"!=typeof e[n]||e[n]>=u[n])return null;h+=(f*=n>0?u[c-n]:1)*e[c-n-1]}else d.push(n),p.push(u[n]);if(d.length>1)return null;if(1===d.length){for(var b=0,y=p[0];b<y;b++){var v=[];for(n=0;n<c;n++)n!==d[0]?v.push(e[n]):v.push(b);o.push(this.Data(v,t))}return o}return t?{value:this.value[h],status:this.status?this.status[h]:null}:this.value[h]}l="array"}var m=function(e,t,n){var r,o=[],s={},l=e.dimension,a=e.id||l.id,u=e.size||l&&l.size;if("array"===n){for(r=t.length;r--;)s[t[r][0]]=t[r][1];t=s}for(var c=0,f=a.length;c<f;c++){var h=a[c],d=t[h];o.push("string"==typeof d?d:1===u[c]?i(l[h].category.index):null)}return o}(a,e,l),g=[],w=a.dimension,_=a.id||w.id;for(n=0,r=m.length;n<r;n++)g.push(w[_[n]].category.index[m[n]]);return this.Data(g,t)},J.prototype.toTable=function(e,t){if(null===this||"dataset"!==this.class)return null;1==arguments.length&&"function"==typeof e&&(t=e,e=null),e=e||{field:"label",content:"label",vlabel:"Value",slabel:"Status",type:"array",status:!1,unit:!1,by:null,prefix:"",drop:[],meta:!1,comma:!1,bylabel:!1};var n,r,o,i,s,l=this.__tree__,a=!0===e.status;if("function"==typeof t){n=this.toTable(e);var u=[],c="array"!==e.type?0:1;for(s=(z="object"!==e.type?n.slice(c):n.rows.slice(0)).length,r=0;r<s;r++){var f=t.call(this,z[r],r);void 0!==f&&u.push(f)}return"object"===e.type?{cols:n.cols,rows:u}:("array"===e.type&&u.unshift(n[0]),u)}if("arrobj"===e.type){var h=[],d=(n=this.toTable({field:"id",content:e.content,status:a})).shift(),p=l.role&&l.role.metric,b=function(){},y={},v=this,m=v.id,g=e.by&&-1!==m.indexOf(e.by)?e.by:null,w=!0===e.meta,_=void 0!==e.drop&&Array.isArray(e.drop)?e.drop:[],x=!0===e.comma,O=!0===e.bylabel,E=function(t){if(w){var n={};return m.forEach((function(e){var t=v.Dimension(e);n[e]={label:t.label,role:t.role,categories:{id:t.id,label:v.Dimension(e,!1)}}})),{meta:{label:v.label,source:v.source,updated:v.updated,id:m,status:a,unit:e.unit,by:g,bylabel:O,drop:null!==g&&_.length>0?_:null,prefix:null!==g?D||"":null,comma:x,dimensions:n},data:t}}return t};if(null===g&&e.unit&&p){if("id"!==e.content)for(var S=p.length;S--;){var j=this.Dimension(p[S]);y[p[S]]={};for(var P=j.length;P--;)y[p[S]][j.Category(P).label]=j.id[P]}b=function(t,n){if(-1!==p.indexOf(t)){var r=l.dimension[t].category;r.unit?T.unit=r.unit["id"!==e.content?y[t][n]:n]:T.unit=null}},e.unit=!0}else e.unit=!1;for(s=n.length,r=0;r<s;r++){var T={};for(o=n[r].length;o--;)T[d[o]]=n[r][o],b(d[o],n[r][o]);h.push(T)}if(x&&h.forEach((function(e){null!==e.value&&(e.value=(""+e.value).replace(".",","))})),null!==g){var A,k={},z=[],C={},D=void 0!==e.prefix?e.prefix:"";_.forEach((function(e,t){(!v.Dimension(e)||v.Dimension(e).length>1)&&(_[t]="")}));var B=m.filter((function(e){return e!==g&&-1===_.indexOf(e)})),L=v.Dimension(g),$=function(e,t){var n=[];return t.forEach((function(t){n.push(e[t])})),n.join("\t")},R=function(e,t){var n={};return t.forEach((function(t){n[t]=e[t]})),n};for(var U in"id"!==e.content?O?A=function(e,t,n){e[t][D+n[g]]=n.value}:(L.Category().forEach((function(e,t){C[e.label]=L.id[t]})),A=function(e,t,n){e[t][D+C[n[g]]]=n.value}):A=function(e,t,n){e[t][D+n[g]]=n.value},h.forEach((function(e){var t=$(e,B);void 0===k[t]&&(k[t]=R(e,B)),A(k,t,e,g)})),k)z.push(k[U]);return a=!1,E(z)}return E(h)}var N,q,F,H,I="id"===e.field;if("object"===e.type){var M="number"==typeof this.value[0]||null===this.value[0]?"number":"string";N=function(e,t){var n=I&&e||t||e;te.push({id:e,label:n,type:"string"})},q=function(e,t,n){var r=(I?"value":e)||"Value",o=(I?"status":t)||"Status";n&&te.push({id:"status",label:o,type:"string"}),te.push({id:"value",label:r,type:M})},F=function(e){pe.push({v:e})},H=function(e){pe.push({v:e}),ne.push({c:pe})}}else N=function(e,t){var n=I&&e||t||e;te.push(n)},q=function(e,t,n){var r=(I?"value":e)||"Value",o=(I?"status":t)||"Status";n&&te.push(o),te.push(r),ee.push(te)},F=function(e){pe.push(e)},H=function(e){pe.push(e),ee.push(pe)};var V=l.dimension,J=l.id||V.id,G=l.size||V.size,Z=J.length;if(Z!=G.length)return!1;var K=[],Y=1,Q=(S=1,[]),W=[],X=[],ee=[],te=[],ne=[];for(r=0;r<Z;r++){var re=J[r],oe=V[re].label;N(re,oe),Y*=G[r],S*=G[r];var ie=[];for(o=0;o<G[r];o++)for(var se in V[J[r]].category.index)if(V[J[r]].category.index[se]===o){var le="id"!==e.content&&V[J[r]].category.label?V[J[r]].category.label[se]:se;ie.push(le)}K.push(ie),Q.push(S)}for(q(e.vlabel,e.slabel,a),s=K.length,r=0;r<s;r++){for(var ae=[],ue=0,ce=K[r].length;ue<ce;ue++)for(var fe=0;fe<Y/Q[r];fe++)ae.push(K[r][ue]);W.push(ae)}for(s=W.length,r=0;r<s;r++){var he=[],de=0;for(i=0;i<Y;i++)he.push(W[r][de]),++de===W[r].length&&(de=0);X.push(he)}for(i=0;i<Y;i++){var pe=[];s=W.length;for(var be=0;be<s;be++)F(X[be][i]);a&&F(this.status?this.status[i]:null),H(this.value[i])}return"object"===e.type?{cols:te,rows:ne}:ee},J.prototype.node=function(){return this.__tree__},J.prototype.toString=function(){return this.class},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};var ae="3.0.2";export{ee as datalist,re as fromCSV,oe as fromSDMX,ne as fromTable,ie as join,X as tbrowser,le as toCSV,ae as version};
