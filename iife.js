// jsonstat-suite v3.3.0 Copyright 2022 Xavier Badosa https://jsonstat.com
var JSONstatUtils=function(e,t){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(t);function a(e,t){return null==e?null:("string"!=typeof e&&void 0!==e.length||(e=r.default(e)),0===e.length||"dataset"!==e.class&&"collection"!==e.class&&"bundle"!==e.class?null:"dataset"===e.class?e:e.Dataset(t))}function l(e){if(null===e||0===e.length||"dataset"!==e.class)return!1;for(var t=e.length,n=1;t--;)n*=e.Dimension(t).length;return n===e.n}function i(e,t,n){var r,a,l,i,o;return(t.label||n).capitalize()+(a=t,o="",(r=e)&&"metric"===r.role&&a.unit&&(l=a.unit.hasOwnProperty("label")?a.unit.label:"")+(i=a.unit.hasOwnProperty("symbol")?a.unit.symbol:"")!==""&&(o=" ("+(o=""===i?l:""===l?i:"start"===a.unit.position?i+l:l+" "+i)+")"),o)}function o(e,t,n){var r,a='<select name="'+t+'">',l=[];if(null!==n[1]){if(r=e.id,l=e.Dimension(),2===r.length)return(e.Dimension(n[0]).label||n[0]).capitalize()}else{var o=e.Dimension(t);if(r=o.id,l=o.Category(),1===r.length)return}return r.forEach((function(e,t){var r=e!==n[0]?"":'selected="selected" ';null!==n[1]&&e===n[1]||(a+="<option "+r+'value="'+e+'">'+i(o,l[t],e)+"</option>")})),a+="</select>"}function s(e,t){var n={};return Array.isArray(e[t])?(e[t].forEach((function(e,t){null!==e&&(n[String(t)]=e)})),n):e[t]}function u(e,t){if(void 0===e)return null;void 0===t&&(t={}),"boolean"!=typeof t.ovalue&&(t.ovalue=!1),"boolean"!=typeof t.ostatus&&(t.ostatus=!1),"boolean"!=typeof t.instance&&(t.instance=!1);var n=t.vlabel||"Value",a=t.slabel||"Status",l=t.type||"array",i=t.label||"",o=t.header||null,u=[],c=[],f=[],d=[],h={},v={},p=function(e,t){for(var n=1,r=0,a=0;a<E;a++)r+=(n*=a>0?t[E-a]:1)*e[E-a-1];return r},b=function(){var t=e[S][n];f[p(A,c)]=isNaN(t)?null:t};switch(l){case"array":e=function(e){for(var t=e[0],n=e.slice(1),r=[],a=0,l=n.length;a<l;a++){for(var i=0,o=t.length,s={};i<o;i++)s[t[i]]=n[a][i];r.push(s)}return r}(e);break;case"object":e=function(e){for(var t=e.cols.map((function(e){return e.id})),n=e.rows,r=[],a=0,l=n.length;a<l;a++){for(var i=0,o=t.length,s={};i<o;i++)s[t[i]]=n[a].c[i].v;r.push(s)}return r}(e)}var y,g=e.length;for(var m in t.hasOwnProperty("drop")&&Array.isArray(t.drop)&&t.drop.length&&e.forEach((function(e){t.drop.forEach((function(t){delete e[t]}))})),e[0])if(m!==n)if(m!==a){if(u.push(m),o)y=o.dimension[m],h[m]=y.category.index;else{h[m]=[];for(var w=0;w<g;w++){var O=e[w][m];-1===h[m].indexOf(O)&&h[m].push(O)}}c.push(h[m].length),v[m]={label:o?y.label:m,category:{index:h[m]}},o&&(v[m].category.label=y.category.label,y.category.unit&&(v[m].category.unit=y.category.unit))}else b=function(){var t=e[S][n],r=e[S][a];f[p(A,c)]=isNaN(t)?null:t,d[p(A,c)]=""===r?null:r};for(var E=u.length,S=0;S<g;S++){for(var A=[],x=0;x<E;x++){var P=u[x];A.push(h[P].indexOf(e[S][P]))}b()}var j={version:"2.0",class:"dataset",value:f,dimension:v,id:u,size:c};return i&&(j.label=i),d.length&&(j.status=d),o&&(o.label&&(j.label=o.label),o.source&&(j.source=o.source),o.updated&&(j.updated=o.updated),o.href&&(j.href=o.href),o.role&&(j.role=o.role)),t.ovalue&&(j.value=s(j,"value")),t.ostatus&&j.hasOwnProperty("status")&&(j.status=s(j,"status")),t.instance?r.default(j):j}function c(e,t){return null==e?"":-1!==e.indexOf(t)?'"'+e+'"':e}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};return e.datalist=function(e,t){if(void 0===e)return null;void 0===t&&(t={});var n="",r="",i="",o=0,s=t.na||"n/a",u=t.dsid||0,c=t.vlabel||null,f=t.slabel||null,d=t.counter||!1,h=t.tblclass||"",v=t.numclass||"",p=t.valclass||"",b=t.status||!1,y=t.locale||"en-US",g=t.source||"Source",m=a(e,u),w=m.role&&m.role.metric?m.id.indexOf(m.role.metric[0]):null,O=m.Dimension({role:"metric"}),E={},S=Number.toLocaleString&&"none"!==y?function(e,t){return null===t?e.toLocaleString(y):e.toLocaleString(y,{minimumFractionDigits:t,maximumFractionDigits:t})}:function(e,t){return null===t?e:e.toFixed(t)},A=function(e,t){var a=null;e.forEach((function(e,l){var i=j===l?' class="'+v+" "+p+'"':"",o=s;t?(w===l&&(a=E[e]),null!==e&&(o=j===l?S(e,a):e),r+="<td"+i+">"+o+"</td>"):n+="<th"+i+">"+e+"</th>"}))},x=d?function(e,t){t?r+='<tr><td class="'+v+'">'+t+"</td>":n+='<th class="'+v+'">#</th>',A(e,t),r+="</tr>"}:function(e,t){r+="<tr>",A(e,t),r+="</tr>"};if(!l(m))return null;O&&O[0].Category().forEach((function(e){var t=e.unit&&e.unit.hasOwnProperty("decimals")?e.unit.decimals:null;E[e.label]=t}));var P=m.toTable({status:b,vlabel:c,slabel:f}),j=P[0].length-1;return P.forEach((function(e,t){x(e,t)})),m.source&&(o=m.length+1,d&&o++,b&&o++,"."!==(g+=": "+m.source).slice(-1)&&(g+="."),i='<tfoot><td colspan="'+o+'">'+g+"</td></tfoot>"),'<table class="'+h+'"><caption>'+(t.caption||m.label||"")+"</caption><thead><tr>"+n+"</tr></thead><tbody>"+r+"</tbody>"+i+"</table>"},e.fromCSV=function(e,t){if(void 0===e)return null;void 0===t&&(t={});var n,r,a,l=[],i=null,o=null,s=!1,c={time:[],geo:[],metric:[]},f="jsonstat"===e.substring(0,8),d=f?"value":t.vlabel,h=f?"status":t.slabel,v=f?e.substring(8,9):t.delimiter||",",p=";"===v?t.decimal||",":t.decimal||".",b=function(e,t){t=t||",";for(var n,r,a=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),l=[[]],i=null;i=a.exec(e);)(r=i[1]).length&&r!=t&&l.push([]),n=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],l[l.length-1].push(n);return l}(e.trim(),v);if(f){for(p=b[0][1],a=b[0][2],b.shift();"data"!==b[0][0];)l.push(b.shift());b.shift(),o={dimension:{}},l.forEach((function(e){var t,n,r,l,i,u,f,d;switch(e[0]){case"dimension":if(o.dimension[e[1]]={},(l=o.dimension[e[1]]).label=e[2],l.category={},(i=l.category).index=[],n={},r=2*e[3]+3,e.length>=r){for(t=4;t<r;t++)f=e[t],d=e[++t],Object.defineProperty(n,f,{value:d,writable:!0,configurable:!0,enumerable:!0}),i.label=n,i.index.push(f);"string"==typeof e[t]&&-1!==["time","geo","metric"].indexOf(e[t])&&(c[e[t]].push(e[1]),s=!0,"metric"===e[t]&&"string"==typeof e[++t]&&(i.unit={},i.index.forEach((function(n,r){var l=e[t+r].split(a);i.unit[n]={},u=i.unit[n],void 0!==l[0]&&""!==l[0]&&(u.decimals=1*l[0]),void 0!==l[1]&&""!==l[1]&&(u.label=l[1]),void 0!==l[2]&&""!==l[2]&&(u.symbol=l[2]),void 0!==l[1]&&-1!==["start","end"].indexOf(l[3])&&(u.position=l[3])}))))}break;case"label":case"source":case"updated":case"href":o[e[0]]=e[1]||null}})),s&&(c.time.length||delete c.time,c.geo.length||delete c.geo,c.metric.length||delete c.metric,o.role=c)}if(n=b.length,r=b[0].length,void 0!==d){for(;r--;)if(b[0][r]===d){i=r;break}if(null===i)return null}else i=r-1,d=b[0][i];if(","===p)for(r=1;r<n;r++)b[r][i]=Number(b[r][i].replace(",","."));else for(r=1;r<n;r++)b[r][i]=Number(b[r][i]);return u(b,{header:o,vlabel:d,slabel:h,type:"array",label:t.label||"",ovalue:t.ovalue||!1,ostatus:t.ostatus||!1,instance:t.instance||!1})},e.fromSDMX=function(e,t){if("object"!=typeof e)return null;if(e.hasOwnProperty("data")&&e.hasOwnProperty("meta")&&e.data.hasOwnProperty("dataSets")&&e.data.hasOwnProperty("structures")&&Array.isArray(e.data.structures)&&(e.dataSets=e.data.dataSets,e.structure=e.data.structures[0],e.header=e.meta),!e.hasOwnProperty("dataSets")||!Array.isArray(e.dataSets))return null;if(1!==e.dataSets.length)return null;e.dataSets[0].hasOwnProperty("observations")||function(e){var t=e.dataSets[0],n=t.series,r=e.structure,a=r.dimensions,l={};Object.keys(n).forEach((function(e){var t=n[e].observations;Object.keys(t).forEach((function(r){l[e+":"+r]=t[r].concat(n[e].attributes)}))})),t.observations=l,delete t.series,a.observation=a.series.concat(a.observation),delete a.series,r.attributes.observation=r.attributes.observation.concat(r.attributes.series),delete r.attributes.series}(e),void 0===t?t={ovalue:!1,ostatus:!1,instance:!1}:("boolean"!=typeof t.ovalue&&(t.ovalue=!1),"boolean"!=typeof t.ostatus&&(t.ostatus=!1),"boolean"!=typeof t.instance&&(t.instance=!1));var n=e.structure,a=e.dataSets[0].observations,l=n.attributes.observation,i=n.dimensions;if(!i.hasOwnProperty("observation"))return null;if(i.hasOwnProperty("series")&&Object.keys(i.series).length)return null;Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(e){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,n=Object(this),r=n.length>>>0,a=0;if(arguments.length>=2)t=arguments[1];else{for(;a<r&&!(a in n);)a++;if(a>=r)throw new TypeError("Reduce of empty array with no initial value");t=n[a++]}for(;a<r;)a in n&&(t=e(t,n[a],a,n)),a++;return t}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var r=arguments[1],a=0;a<n;){var l=t[a];if(e.call(r,l,a,t))return l;a++}},configurable:!0,writable:!0}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var r=arguments[1],a=0;a<n;){var l=t[a];if(e.call(r,l,a,t))return a;a++}return-1},configurable:!0,writable:!0});var o=1,s=[],u=[],c={},f=[],d={time:[],geo:[]},h=function(){},v=function(e,t){for(var n=e.size,r=n.length-t.length;r--;)t.push(0);for(var a=0,l=n.length,i=0,o=1;a<l;a++)i+=(o*=a>0?n[l-a]:1)*t[l-a-1];return i},p=function(e){if(c[e.id]={label:e.name},e.hasOwnProperty("role"))switch(e.role){case"REF_AREA":d.geo.push(e.id);break;case"TIME_PERIOD":d.time.push(e.id)}Object.defineProperty(c[e.id],"category",{value:{index:[],label:{}},writable:!0,enumerable:!0}),s.push(e.id),u.push(e.values.length),o*=e.values.length;var t=c[e.id].category;e.values.forEach((function(e){t.index.push(e.id),Object.defineProperty(t.label,e.id,{value:e.name,writable:!0,enumerable:!0})}))},b=e.header.links?e.header.links.find((function(e){return"request"===e.rel})):null,y=l.findIndex((function(e){return"OBS_STATUS"===e.id}));-1!==y&&(l[y].values.length?f=l[y].values:y=-1),i.observation.forEach(p),i.hasOwnProperty("dataSet")&&i.dataSet.forEach(p);var g={version:"2.0",class:"dataset",updated:e.header.prepared||null,source:e.header.sender.name||null,label:n.name||null,id:s,size:u,dimension:c,value:t.ovalue?{}:new Array(o).fill(null)};for(var m in b&&(g.link={alternate:[{type:"application/vnd.sdmx.data+json",href:b.href}]}),d.geo.length+d.time.length>0&&(d.time.length||delete d.time,d.geo.length||delete d.geo,g.role=d),-1!==y&&(g.status=t.ostatus?{}:new Array(o).fill(null),g.extension={status:{label:{}}},f.forEach((function(e){g.extension.status.label[e.id]=e.name})),h=t.ostatus?function(){var e=a[m][y];null!==e&&(g.status[v(g,w)]=f[e].id)}:function(){var e=a[m][y];g.status[v(g,w)]=null===e?null:f[e].id}),y++,a){var w=m.split(":");t.ovalue&&null===a[m][0]||(g.value[v(g,w)]=a[m][0]),h()}return t.instance?r.default(g):g},e.fromTable=u,e.join=function(e,t){if(void 0===e||!Array.isArray(e))return null;var n=JSON.parse(JSON.stringify(e)),a=n[0];if(!a.hasOwnProperty("version")||!a.hasOwnProperty("class")||"dataset"!==a.class)return null;void 0===t&&(t={});var l=void 0===t.label?null:t.label,i=void 0===t.by?null:t.by,o=[];if(null===i){for(var s=1,c=n.length;s<c;s++)o=o.concat(n[s].value);return a.value=o,null!==l&&(a.label=l),a}var f,d,h,v=function(e,t,n){if(Array.isArray(e))e=e.concat(t);else for(var r in t)e[r]=0===t[r]?n:t[r];return e};n.forEach((function(e,t){var n=r.default(e).toTable({status:!0}),a=e.dimension[i].category;0===t?(o=[n[0]],f=a.index,d=a.label,h=a.unit):(f=function(e,t,n){if(Array.isArray(e))e=e.concat(t);else for(var r in t)e[r]=t[r]+n;return e}(f,a.index,Object.keys(f).length),d=v(d,a.label,t),h=v(h,a.unit,t)),o=o.concat(n.slice(1))}));var p=u(o);return a.value=p.value,a.size=p.size,a.status=p.status||null,a.label=l||"",a.href=null,a.dimension[i].category.index=f||null,a.dimension[i].category.label=d||null,a.dimension[i].category.unit=h||null,a},e.tbrowser=function(e,t,n){function r(e){void 0!==t?t.innerHTML=s[e]:window.alert(s[e])}if(void 0!==e)if(void 0!==t){void 0===n&&(n={});var s=void 0===n.i18n||void 0===n.i18n.msgs?{urierror:"tbrowser: A valid JSON-stat input must be specified.",selerror:"tbrowser: A valid selector must be specified.",jsonerror:"The request did not return a valid JSON-stat dataset.",dimerror:"Only one dimension was found in the dataset. At least two are required.",dataerror:"Selection returned no data!",source:"Source",filters:"Filters",constants:"Constants",rc:"Rows &amp; Columns",na:"n/a"}:n.i18n.msgs,u=void 0===n.i18n||void 0===n.i18n.locale?"en-US":n.i18n.locale,c=n.dsid||0,f=n.status||!1,d=n.tblclass||"",h=n.nonconst||!1,v=a(e,c);if(l(v)){if(h)var p=function(e){var t=0,n=e.size.slice(0),r=[];return n.forEach((function(n,a){var l=a-t,i=e.Dimension(l);1===n&&(delete e.__tree__.dimension[e.id[l]],e.size.splice(l,1),e.id.splice(l,1),e.length--,t++,r.push(i.label.capitalize()+": "+i.Category(0).label.capitalize()))})),r}(v);1!==v.length?function e(t,n,r,a){var l="",c="",d="",v="",b=r.rows,y=n.Dimension(b),g=y.id,m=r.cols,w=n.Dimension(m),O=w.id,E=n.role&&n.role.metric?n.role.metric[0]:null,S=null!==E?n.Dimension(E):null,A=function(e){return e.hasOwnProperty("unit")&&e.unit&&e.unit.hasOwnProperty("decimals")?e.unit.decimals:null},x=r.filter,P=JSON.parse(JSON.stringify(x)),j=[],D="",T="",N=n.source?s.source+": "+n.source:"",z=null!==n.label?'<span class="label">'+n.label.capitalize()+"</span>":"";for(var C in h&&p.length&&(z='<span class="label">'+p.join(". ")+"</span>"),""!==N&&"."!==N.slice(-1)&&(N+="."),d+="<caption>"+z+"<form>",x){var R=n.Dimension(C),_=R.label?R.label.capitalize():C.capitalize();R.length>1?D+="<p>"+o(n,C,[x[C],null])+" <strong>"+_+"</strong></p>":j.push({label:_,value:i(R,R.Category(0)),name:C,id:R.id[0]})}""!==D&&(D='<fieldset id="filters"><legend>'+s.filters+"</legend>"+D+"</fieldset>"),j.forEach((function(e){T+="<p>"+e.value+" <strong>"+e.label+'</strong></p><input type="hidden" name="'+e.name+'" value="'+e.id+'" />'})),""!==T&&(T='<fieldset id="constants"><legend>'+s.constants+"</legend>"+T+"</fieldset>"),d+=T+D+'<fieldset id="rowscols"><legend>'+s.rc+"</legend>"+o(n,"rows",[b,m])+" <a>&#x2194;</a> "+o(n,"cols",[m,b])+"</fieldset></form></caption>",v+="<tbody>";var k=Number.toLocaleString&&"none"!==u?function(e,t){return null===t?e.toLocaleString(u):e.toLocaleString(u,{minimumFractionDigits:t,maximumFractionDigits:t})}:function(e,t){return null===t?e:e.toFixed(t)};if(g.forEach((function(e){P[b]=e;var t=n.Data(P),r=function(e,t){var n,r=m!==E?null===S?null:A(S.Category(P[E])):A(w.Category(t));null!==e.value?(n=k(e.value,r),f&&null!==e.status&&(n+=" ("+e.status+")")):n=e.status||s.na,v+="<td>"+n+"</td>"};null!==t?(v+='<tr><th scope="row">'+i(y,y.Category(e))+"</th>",Array.isArray(t)?t.forEach((function(e,t){r(e,t)})):r(t,0),v+="</tr>"):v="ERROR"})),"ERROR"===v)return s.dataerror;v+="</tbody>",l+="<thead><tr><th></th>",O.forEach((function(e){l+='<th scope="col">'+i(w,w.Category(e))+"</th>"})),l+="</tr></thead>",""!==N&&(c='<tfoot><tr><td colspan="'+(O.length+1)+'">'+N+"</td></tr></tfoot>"),t.innerHTML='<table class="'+a+'">'+d+l+v+c+"</table>",[].slice.call(t.querySelectorAll("select")).forEach((function(r){r.addEventListener("change",(function(r){var l,i;e(t,n,function(e,t,n){var r={filter:{}};return n.forEach((function(e){"rows"===e.name||"cols"===e.name?r[e.name]=e.value:r.filter[e.name]=e.value})),"rowscols"===t&&e.id.forEach((function(t,n){t!==r.rows&&t!==r.cols?void 0===r.filter[t]&&(r.filter[t]=e.Dimension(n).id[0]):delete r.filter[t]})),r}(n,r.target.parentElement.getAttribute("id"),(l=t,i=[],[].slice.call(l.querySelectorAll("select, input")).forEach((function(e){i.push({name:e.name,value:e.value})})),i)),a)}),!1)})),t.querySelector("a").addEventListener("click",(function(){r.cols=b,r.rows=m,e(t,n,r,a)}),!1)}(t,v,function(e,t){var n,r,a={},l=[],i=e.id;if(t){var o="bigger"===t?function(e,t){return e.len<t.len?1:-1}:function(e,t){return e.len>t.len?1:-1};e.Dimension().forEach((function(e,t){l.push({id:i[t],len:e.length})})),l.sort(o),n=l[0].id,r=l[1].id}else n=i[0],r=i[1];return e.Dimension(n).length<e.Dimension(r).length&&(n=r+(r=n,"")),i.forEach((function(t){t!==n&&t!==r&&(a[t]=e.Dimension(t).id[0])})),{rows:n,cols:r,filter:a}}(v,n.preset),d):r("dimerror")}else r("jsonerror")}else r("selerror");else r("urierror")},e.toCSV=function(e,t){if(void 0===e)return null;void 0===t&&(t={});var n=!0===t.rich,r=t.content||"label",i=t.field||"label",o=n?"value":t.vlabel||"Value",s=n?"status":t.slabel||"Status",u=!0===t.status,f=t.na||"n/a",d=t.delimiter||",",h=t.separator||"|",v=";"===d?t.decimal||",":t.decimal||".",p=!0===t.array,b=a(e,t.dsid||0),y=p?[]:"",g=p?[]:"",m=p?function(e){y.push(e)}:function(e){y+=e+"\n"},w=p?function(e){g.push(e)}:function(e){g+=e+"\n"};if(!l(b))return null;n&&(u=null!==b.status);var O=b.toTable({vlabel:o,slabel:s,status:u,field:n?"id":i,content:n?"id":r,type:"array"}),E=O[0].indexOf("id"===i?"value":o),S=u?O[0].indexOf("id"===i?"status":s):-1;return O.forEach((function(e,t){e.forEach((function(n,r){t&&r===E?null===n?e[r]=c(f,d):"."!==v&&(e[r]=String(e[r]).replace(".",v)):e[r]=t&&r===S&&null===n?"":c(e[r],d)})),m(e.join(d))})),n&&(w("jsonstat"+d+v+d+h),["label","source","updated","href"].forEach((function(e){b[e]&&w(e+d+c(b[e],d))})),b.id.forEach((function(e,t){var n=[],r=b.Dimension(t),a=r.role,l=!1,i="";i+="dimension"+d+c(e,d)+d+c(r.label,d)+d+r.length,"metric"===a&&r.__tree__.category.unit&&(l=!0),r.id.forEach((function(e,t){var a=[],o=r.Category(t);i+=d+c(e,d)+d+c(o.label,d),l&&(a.push(o.unit.hasOwnProperty("decimals")?o.unit.decimals:""),a.push(o.unit.label||""),o.unit.symbol&&(a.push(o.unit.symbol),a.push(o.unit.position)),n.push(c(a.join(h),d)))})),null!==a&&"classification"!==a&&(i+=d+r.role,l&&(i+=d+n.join(d))),w(i)})),y=p?g.concat(["data"],y):g+"data\n"+y),y},e.version="3.3.0",Object.defineProperty(e,"__esModule",{value:!0}),e}({},JSONstat);
